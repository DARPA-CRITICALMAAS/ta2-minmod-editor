(this["webpackJsonpminmod-editor"]=this["webpackJsonpminmod-editor"]||[]).push([[0],{240:function(e,t,o){},272:function(e,t,o){},281:function(e,t,o){"use strict";o.r(t);var i=o(45),n=o.n(i),r=(o(240),o(40));var a=e=>{e&&e instanceof Function&&o.e(3).then(o.bind(null,316)).then((t=>{let{getCLS:o,getFID:i,getFCP:n,getLCP:r,getTTFB:a}=t;o(e),i(e),n(e),r(e),a(e)}))},s=o(0),c=o.n(s),d=o(312),l=o(9);Object({NODE_ENV:"production",PUBLIC_URL:"/editor",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_PLATFORM;const u="native"===Object({NODE_ENV:"production",PUBLIC_URL:"/editor",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_PLATFORM?Object({NODE_ENV:"production",PUBLIC_URL:"/editor",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_SERVER:"",m="/editor";var h=o(307);class p extends r.e{constructor(){super("".concat(u,"/api/v1"),{id:"username"},!1)}async login(e,t){let o=await h.a.post("".concat(u,"/api/v1/login"),{username:e,password:t});return Object(l.r)((()=>{this.set(this.deserialize(o.data))}))}async isLoggedIn(){if(this.records.size>0)return!0;try{let e=await h.a.get("".concat(u,"/api/v1/whoami"));return Object(l.r)((()=>{this.set(this.deserialize(e.data))})),!0}catch(e){return!1}}getCurrentUser(){if(0!==this.records.size)return this.records.values().next().value||void 0}deserialize(e){return{id:e.username,email:e.email,name:e.name,url:"https://minmod.isi.edu/users/".concat(e.username)}}}class v extends r.e{constructor(){super("".concat(u,"/api/v1/commodities"),void 0,!1)}async fetchCriticalCommotities(){(this.refetch||0===this.records.size)&&await this.fetch({});const e=[];for(const t of this.records.values())null!==t&&t.isCritical&&e.push(t);return e}getByName(e){if(0!==this.records.size){for(const t of this.records.values())if(null!==t&&t.name===e)return t;return null}}deserialize(e){return{id:e.uri.substring(e.uri.lastIndexOf("/")+1),uri:e.uri,name:e.name,isCritical:e.is_critical}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class y extends r.e{constructor(){super("".concat(u,"/api/v1/deposit-types"),void 0,!1,[new r.g("name","id"),new r.g("uri","id")])}get name2id(){return this.indices[0]}get uri2id(){return this.indices[1]}getByName(e){let t=this.name2id.index.get(e);return void 0===t?void 0:this.records.get(t)}getByURI(e){let t=this.uri2id.index.get(e);return void 0===t?void 0:this.records.get(t)}async fetchAll(){(this.refetch||0===this.records.size)&&await this.fetch({})}deserialize(e){return{...e,id:e.uri}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class g extends r.e{constructor(){super("".concat(u,"/api/v1/countries"),void 0,!1)}getByURI(e){const t=this.records.get(e);if(null!==t)return t}async fetchAll(){(this.refetch||0===this.records.size)&&await this.fetch({})}deserialize(e){return{id:e.uri,name:e.name}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class f extends r.e{constructor(){super("".concat(u,"/api/v1/states-or-provinces"),void 0,!1)}getByURI(e){const t=this.records.get(e);if(null!==t)return t}async fetchAll(){(this.refetch||0===this.records.size)&&await this.fetch({})}deserialize(e){return{id:e.uri,name:e.name}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class j{constructor(e){let{source:t,confidence:o,observedName:i,normalizedURI:n}=e;this.source=void 0,this.confidence=void 0,this.observedName=void 0,this.normalizedURI=void 0,this.source=t,this.confidence=o,this.observedName=i,this.normalizedURI=n}clone(){return new j({source:this.source,confidence:this.confidence,observedName:this.observedName,normalizedURI:this.normalizedURI})}static deserialize(e){return new j({source:e.source,confidence:e.confidence,observedName:e.observed_name,normalizedURI:e.normalized_uri})}serialize(){return{source:this.source,confidence:this.confidence,observed_name:this.observedName,normalized_uri:this.normalizedURI}}}class b{constructor(e){let{commodity:t,totalTonnage:o,totalGrade:i,totalContainedMetal:n}=e;this.commodity=void 0,this.totalTonnage=void 0,this.totalGrade=void 0,this.totalContainedMetal=void 0,this.commodity=t,this.totalTonnage=o,this.totalGrade=i,this.totalContainedMetal=n}clone(){return new b({commodity:this.commodity,totalTonnage:this.totalTonnage,totalGrade:this.totalGrade,totalContainedMetal:this.totalContainedMetal})}static deserialize(e){return new b({commodity:e.commodity,totalTonnage:e.total_tonnage,totalGrade:e.total_grade,totalContainedMetal:e.total_contained_metal})}}class O{constructor(e){let{document:t,comment:o,property:i}=e;this.document=void 0,this.comment=void 0,this.property=void 0,this.document=t,this.comment=o,this.property=i}clone(){return new O({document:this.document.clone(),comment:this.comment,property:this.property})}static deserialize(e){return e={...e,document:x.deserialize(e.document)},new O(e)}serialize(){return{document:this.document.serialize(),comment:this.comment,property:this.property}}static normalizeProperty(e){switch(e){case"name":return"http://www.w3.org/2000/01/rdf-schema#label";case"location":return"https://minmod.isi.edu/ontology/location";case"depositType":return"https://minmod.isi.edu/ontology/deposit_type";case"grade":return"https://minmod.isi.edu/ontology/grade";case"tonnage":return"https://minmod.isi.edu/ontology/ore";default:return""}}}class x{constructor(e){let{uri:t,title:o}=e;this.uri=void 0,this.title=void 0,this.uri=t,this.title=o}clone(){return new x({uri:this.uri,title:this.title})}static deserialize(e){return new x({uri:e.uri,title:e.title})}serialize(){return{uri:this.uri,title:this.title}}}class T{constructor(e){let{category:t,commodity:o,grade:i,ore:n,reference:r}=e;this.category=void 0,this.commodity=void 0,this.grade=void 0,this.ore=void 0,this.reference=void 0,this.category=t,this.commodity=o,this.grade=i,this.ore=n,this.reference=r}static fromGradeTonnage(e,t,o,i){const n=e.commodityStore.get(o.commodity);return new T({category:["Inferred","Indicated","Measured"].map((e=>new j({source:t,confidence:1,observedName:e,normalizedURI:"https://minmod.isi.edu/resource/"+e}))),commodity:new j({source:t,confidence:1,observedName:n.name,normalizedURI:n.uri}),grade:void 0===o.totalGrade?void 0:new S({value:o.totalGrade,unit:new j({source:t,confidence:1,observedName:"%",normalizedURI:"https://minmod.isi.edu/resource/Q201"})}),ore:void 0===o.totalTonnage?void 0:new S({value:o.totalTonnage,unit:new j({source:t,confidence:1,observedName:"%",normalizedURI:"https://minmod.isi.edu/resource/Q202"})}),reference:i})}static deserialize(e){return new T({category:void 0===e.category?[]:e.category.map(j.deserialize),commodity:j.deserialize(e.commodity),grade:void 0===e.grade?void 0:S.deserialize(e.grade),ore:void 0===e.ore?void 0:S.deserialize(e.ore),reference:O.deserialize(e.reference)})}}class S{constructor(e){let{value:t,unit:o}=e;this.value=void 0,this.unit=void 0,this.value=t,this.unit=o}static deserialize(e){return new S({value:e.value,unit:j.deserialize(e.unit)})}}class w{constructor(e){let{id:t,recordId:o,sourceId:i,createdBy:n,name:r,locationInfo:a,depositTypeCandidate:s,reference:c,sameAs:d,gradeTonnage:l,dedupSiteURI:u,mineralInventory:m}=e;this.id=void 0,this.sourceId=void 0,this.recordId=void 0,this.dedupSiteURI=void 0,this.createdBy=void 0,this.name=void 0,this.locationInfo=void 0,this.depositTypeCandidate=void 0,this.reference=void 0,this.sameAs=void 0,this.gradeTonnage=void 0,this.mineralInventory=void 0,this.id=t,this.recordId=o,this.sourceId=i,this.dedupSiteURI=u,this.createdBy=n,this.name=r,this.locationInfo=a,this.depositTypeCandidate=s,this.reference=c,this.sameAs=d,this.gradeTonnage=l,this.mineralInventory=m}get uri(){return"https://minmod.isi.edu/resource/".concat(this.id)}getReferencedDocuments(){const e={};for(const t of this.reference)e[t.document.uri]=t.document;return e}getFirstReferencedDocument(){return this.reference[0].document}updateField(e,t,o){switch(t.field){case"name":this.name=t.value;break;case"location":this.locationInfo.location=t.value;break;case"depositType":this.depositTypeCandidate=[new j({source:this.createdBy[0],confidence:1,normalizedURI:t.normalizedURI,observedName:t.observedName})];break;case"grade":void 0===this.gradeTonnage[t.commodity]?this.gradeTonnage[t.commodity]=new b({commodity:t.commodity,totalGrade:t.value,totalTonnage:1e-5}):this.gradeTonnage[t.commodity].totalGrade=t.value,this.mineralInventory=[T.fromGradeTonnage(e,this.createdBy[0],this.gradeTonnage[t.commodity],o)];break;case"tonnage":void 0===this.gradeTonnage[t.commodity]?this.gradeTonnage[t.commodity]=new b({commodity:t.commodity,totalTonnage:t.value,totalGrade:1e-5}):this.gradeTonnage[t.commodity].totalTonnage=t.value,this.mineralInventory=[T.fromGradeTonnage(e,this.createdBy[0],this.gradeTonnage[t.commodity],o)];break;default:throw new Error("Unknown edit: ".concat(t))}this.reference.push(o)}}class I extends w{constructor(e){let{draftID:t,...o}=e;super(o),this.draftID=void 0,this.draftID=t}static fromMineralSite(e,t,o,i,n){var r;const a=o[0].id===t.sites[0]?o[0]:o.filter((e=>e.id===t.sites[0]))[0],s="https://minmod.isi.edu/users/".concat(i);return new I({draftID:"draft-".concat(t.id),id:"",sourceId:I.updateSourceId(a.sourceId,i),recordId:a.recordId,dedupSiteURI:t.uri,createdBy:[s],name:t.name,locationInfo:null===(r=t.location||new _({country:[],stateOrProvince:[]}))||void 0===r?void 0:r.toLocationInfo(e,s,1),depositTypeCandidate:t.depositTypes.length>0?[t.getTop1DepositType().toCandidateEntity(e)]:[],reference:[n],sameAs:t.sites,gradeTonnage:{[t.gradeTonnage.commodity]:t.gradeTonnage},mineralInventory:[]})}static updateSourceId(e,t){const[o,i]=e.split("::",2),n=new URL(i);return n.searchParams.set("username",t),"".concat(o,"::").concat(n.toString())}}class C extends w{constructor(){super(...arguments),this.isSaved=!0}updateField(e,t,o){super.updateField(e,t,o),this.isSaved=!1}markSaved(){this.isSaved=!0}toModel(){return new w(this)}}class R{constructor(e){let{country:t,stateOrProvince:o,location:i,crs:n}=e;this.location=void 0,this.country=void 0,this.stateOrProvince=void 0,this.crs=void 0,this.location=i,this.country=t,this.stateOrProvince=o,this.crs=n}static deserialize(e){return new R({location:e.location,country:void 0===e.country?[]:e.country.map(j.deserialize),stateOrProvince:void 0===e.state_or_province?[]:e.state_or_province.map(j.deserialize),crs:void 0===e.crs?void 0:j.deserialize(e.crs)})}clone(){return new R({location:this.location,country:this.country.map((e=>e.clone())),stateOrProvince:this.stateOrProvince.map((e=>e.clone())),crs:this.crs?this.crs.clone():void 0})}}class z extends r.b{constructor(e){super("".concat(u,"/api/v1/mineral-sites"),void 0,!1),this.dedupMineralSiteStore=void 0,this.dedupMineralSiteStore=e}async createAndUpdateDedup(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=await this.create(t,o);return await this.dedupMineralSiteStore.forceFetchByURI(i.dedupSiteURI,e),i}async updateAndUpdateDedup(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=await this.update(t,o);return await this.dedupMineralSiteStore.forceFetchByURI(i.dedupSiteURI,e),i}deserialize(e){return new w({id:e.id,recordId:e.record_id,sourceId:e.source_id,dedupSiteURI:e.dedup_site_uri,createdBy:e.created_by,name:e.name,locationInfo:void 0!==e.location_info?R.deserialize(e.location_info):new R({country:[],stateOrProvince:[]}),depositTypeCandidate:(e.deposit_type_candidate||[]).map(j.deserialize),reference:e.reference.map(O.deserialize),sameAs:e.same_as,gradeTonnage:Object.fromEntries(e.grade_tonnage.map((e=>{const t=b.deserialize(e);return[t.commodity,t]}))),mineralInventory:e.mineral_inventory.map(T.deserialize)})}serializeRecord(e){var t;const o=e.reference.map((e=>e.serialize()));let i=[];for(const n of Object.values(e.gradeTonnage))console.log("@@@",n),i.push({category:["Inferred","Indicated","Measured"].map((t=>({source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/".concat(t)}))),commodity:{source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/".concat(n.commodity)},ore:{value:n.totalTonnage,unit:{source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/Q202"}},grade:{value:n.totalGrade,unit:{source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/Q201"}},reference:o[0]});return{name:e.name,record_id:e.recordId,source_id:e.sourceId,created_by:e.createdBy,dedup_site_uri:e.dedupSiteURI,location_info:{country:e.locationInfo.country.map((e=>e.serialize())),state_or_province:e.locationInfo.stateOrProvince.map((e=>e.serialize())),crs:null===(t=e.locationInfo.crs)||void 0===t?void 0:t.serialize(),location:e.locationInfo.location},deposit_type_candidate:e.depositTypeCandidate.map((e=>e.serialize())),mineral_inventory:i,reference:o,same_as:e.sameAs}}normRemoteSuccessfulResponse(e){return{items:Array.isArray(e.data)?e.data:Object.values(e.data),total:e.total}}}class k{constructor(e){let{uri:t,source:o,confidence:i}=e;this.uri=void 0,this.source=void 0,this.confidence=void 0,this.uri=t,this.source=o,this.confidence=i}toCandidateEntity(e){var t;return new j({source:this.source,confidence:this.confidence,normalizedURI:this.uri,observedName:null===(t=e.depositTypeStore.get(this.uri))||void 0===t?void 0:t.name})}}class _{constructor(e){let{lat:t,lon:o,country:i,stateOrProvince:n}=e;this.lat=void 0,this.lon=void 0,this.country=void 0,this.stateOrProvince=void 0,this.lat=t,this.lon=o,this.country=i,this.stateOrProvince=n}static deserialize(e){return new _({lat:e.lat,lon:e.lon,country:e.country||[],stateOrProvince:e.state_or_province||[]})}toLocationInfo(e,t){let o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return void 0!==this.lat&&void 0!==this.lon&&(o="POINT (".concat(this.lon," ").concat(this.lat,")")),new R({location:o,crs:new j({source:t,confidence:i,normalizedURI:"https://minmod.isi.edu/resource/Q701",observedName:"EPSG:4326"}),country:this.country.map((o=>{var n;return new j({source:t,confidence:i,normalizedURI:o,observedName:null===(n=e.countryStore.get(o))||void 0===n?void 0:n.name})})),stateOrProvince:this.stateOrProvince.map((o=>{var n;return new j({source:t,confidence:i,normalizedURI:o,observedName:null===(n=e.stateOrProvinceStore.get(o))||void 0===n?void 0:n.name})}))})}}class U{constructor(e){let{id:t,uri:o,name:i,type:n,rank:r,sites:a,depositTypes:s,location:c,gradeTonnage:d}=e;this.id=void 0,this.uri=void 0,this.name=void 0,this.type=void 0,this.rank=void 0,this.sites=void 0,this.depositTypes=void 0,this.location=void 0,this.gradeTonnage=void 0,this.id=t,this.uri=o,this.name=i,this.type=n,this.rank=r,this.sites=a,this.depositTypes=s,this.location=c,this.gradeTonnage=d}get commodity(){return this.gradeTonnage.commodity}static getId(e){return e.substring(e.lastIndexOf("/")+1)}static deserialize(e){return new U({id:e.id,uri:"https://minmod.isi.edu/resource/".concat(e.id),name:e.name,type:e.type,rank:e.rank,sites:e.sites,depositTypes:e.deposit_types.map((e=>new k(e))),location:void 0!==e.location?_.deserialize(e.location):void 0,gradeTonnage:b.deserialize(e.grade_tonnage)})}getTop1DepositType(){return this.depositTypes[0]}}class P extends r.e{constructor(e){super("".concat(u,"/api/v1/dedup-mineral-sites"),void 0,!1,[new r.f("commodity","id")]),this.ns=void 0,this.ns=e,Object(l.o)(this,{forceFetchByURI:l.f,deleteByIds:l.f,replaceSites:l.f})}get commodity2ids(){return this.indices[0]}deleteByIds(e){this.state.value="updating";for(const t of e){const e=this.records.get(t);void 0!==e&&null!==e&&(this.deindex(e),this.records.delete(t))}this.state.value="updated"}async replaceSites(e,t,o){this.deleteByIds(e),await this.fetchByIds(t,!0,{commodity:o})}async forceFetchByURI(e,t){const o=U.getId(e);try{this.state.value="updating";let e=await h.a.get("".concat(this.remoteURL,"/").concat(o),{params:{commodity:t}});return Object(l.r)((()=>{let t=this.deserialize(e.data);return this.records.set(t.id,t),this.index(t),this.state.value="updated",this.records.get(t.id)}))}catch(i){if(i.response&&404===i.response.status)return void Object(l.r)((()=>{this.records.set(o,null),this.state.value="updated"}));throw Object(l.r)((()=>{this.state.value="error"})),i}}async fetchByCommodity(e){return!this.refetch&&this.commodity2ids.index.has(e.id)?this.getByCommodity(e):await this.fetch({conditions:{commodity:e.id}})}getByCommodity(e){if(!this.commodity2ids.index.has(e.id))return{records:[],total:0};const t=[];for(const o of this.commodity2ids.index.get(e.id))t.push(this.records.get(o));return{records:t,total:t.length}}deserialize(e){const t=this.ns.MR;return new U({id:e.id,uri:t.getURI(e.id),name:e.name,type:e.type,rank:e.rank,sites:e.sites,depositTypes:e.deposit_types.map((e=>new k({uri:t.getURI(e.id),source:e.source,confidence:e.confidence}))),location:void 0!==e.location?new _({lat:e.location.lat,lon:e.location.lon,country:(e.location.country||[]).map((e=>t.getURI(e))),stateOrProvince:(e.location.state_or_province||[]).map((e=>t.getURI(e)))}):void 0,gradeTonnage:b.deserialize(e.grade_tonnage)})}async updateSameAsGroup(e){return(await h.a.post("/api/v1/same-as",e)).data.map((e=>e.id))}normRemoteSuccessfulResponse(e){return{items:Array.isArray(e.data)?e.data:Object.values(e.data),total:e.total}}deindex(e){for(const t of this.indices)t.remove(e)}}class B{constructor(e,t){this.prefix=void 0,this.namespace=void 0,this.prefix=e,this.namespace=t}getURI(e){return"".concat(this.namespace).concat(e)}}const N=new P(new class{constructor(){this.MR=new B("mr","https://minmod.isi.edu/resource/"),this.MO=new B("mo","https://minmod.isi.edu/ontology/"),this.MD=new B("md","https://minmod.isi.edu/ontology-derived/")}}),F={userStore:new p,commodityStore:new v,dedupMineralSiteStore:N,mineralSiteStore:new z(N),depositTypeStore:new y,stateOrProvinceStore:new f,countryStore:new g};Object(r.j)((e=>{d.a.error("Error while talking with the server.",5)})),window._stores=F,window.toJS=l.s;const A=Object(s.createContext)(F);function D(){return c.a.useContext(A)}var E=o(313),M=o(106),L=o(226),G=o(310),V=o(149),K=o(146),q=o.n(K),W=o(108),H=o(10);const Q=e=>{let{searchArgs:t,setSearchArgs:o}=e;const{commodityStore:i}=D(),[n,r]=Object(s.useState)([]);Object(s.useEffect)((()=>{i.fetchCriticalCommotities().then((e=>{r(e.map((e=>({value:e.id,label:e.name}))))}))}),[i]);return Object(H.jsxs)(L.a,{children:[Object(H.jsxs)(G.a.Text,{children:["Commodity",Object(H.jsx)("span",{style:{color:"red"},children:"*"}),":"]}),Object(H.jsx)(V.a,{style:{width:200},value:t.commodity,placeholder:"Select a commodity",showSearch:!0,optionFilterProp:"label",onChange:e=>{o({commodity:i.get(e).name})},options:n})]})};var J=o(139),X=o(314),Y=o(68),Z=o(306),$=o(228),ee=o(311);const te=e=>{let{entity:t}=e;if(void 0===t)return Object(H.jsx)("span",{children:"-"});const o=void 0===t.observedName?" ":t.observedName;return void 0!==t.normalizedURI?Object(H.jsx)(G.a.Link,{href:t.normalizedURI,target:"_blank",children:o}):Object(H.jsx)("span",{children:o})},oe=e=>{let{entities:t}=e;const o=[];t.length>0&&o.push(Object(H.jsx)(te,{entity:t[0]},0));for(let i=1;i<t.length;i++)o.push(Object(H.jsx)("span",{children:"\xa0-\xa0"})),o.push(Object(H.jsx)(te,{entity:t[i]},i));return Object(H.jsx)(H.Fragment,{children:o})};function ie(e,t){if(0===e.length)return[];const o=[e[0]];for(let i=1;i<e.length;i++)o.push(t(i)),o.push(e[i]);return o}var ne=o(309),re=o(223),ae=o(308),se=o(181),ce=o(315),de=o(185);const le=e=>{const[t,o]=Object(s.useState)(!1),i=e.options.map((t=>({key:t.key,label:t.label,onClick:()=>{o(!0),void 0!==e.onChange&&e.onChange(t.label),e.onProvenanceChange(t.key)}})));return i.push({type:"divider"}),i.push({key:"new",label:"Enter your own",onClick:()=>{o(!0),e.onProvenanceChange(void 0),void 0!==e.onChange&&e.onChange("")}}),t?Object(H.jsx)(re.a,{value:e.value,onChange:t=>void 0!==e.onChange?e.onChange(t.target.value):void 0,placeholder:"Enter your own",suffix:Object(H.jsx)(ce.a,{style:{color:"rgba(0,0,0,.25)"},onClick:()=>{o(!1),void 0!==e.onChange&&e.onChange("")}})}):Object(H.jsx)(se.a,{menu:{items:i,style:{marginLeft:-12,marginTop:8}},children:Object(H.jsx)(re.a,{value:e.value,placeholder:"Select an option or enter your own",suffix:Object(H.jsx)(de.a,{style:{color:"rgba(0,0,0,.25)"}})})})},ue=e=>{let{currentSite:t,sites:o,editField:i,commodity:n,onFinish:r}=e;const{depositTypeStore:a}=D(),[c]=ne.a.useForm(),d=Object(s.useMemo)((()=>{switch(i){case"name":return"Name";case"location":return"Location";case"depositType":return"Deposit Type";case"grade":return"Grade (%)";case"tonnage":return"Tonnage (Mt)";default:return""}}),[i]),l=e=>{if(void 0!==e){const t=o.filter((t=>t.id===e))[0];c.setFieldValue("refDocURI",t.getFirstReferencedDocument().uri)}else c.setFieldValue("refDocURI","")};let u=[],m=[],h={fieldValue:"",refDocURI:"",refComment:"",refAppliedToAll:!0};if("name"===i)u=o.map((e=>({key:e.id,label:e.name}))),void 0!==t&&(h.fieldValue=t.name,h.refDocURI=t.getFirstReferencedDocument().uri,h.refComment=t.reference[0].comment);else if("location"===i)u=o.filter((e=>void 0!==e.locationInfo.location)).map((e=>({key:e.id,label:e.locationInfo.location}))),void 0!==t&&(h.fieldValue=t.locationInfo.location||"",h.refDocURI=t.getFirstReferencedDocument().uri,h.refComment=t.reference[0].comment);else if("depositType"===i){m=q.a.uniqBy(o.flatMap((e=>e.depositTypeCandidate)).filter((e=>void 0!==e.normalizedURI)),"normalizedURI").sort(((e,t)=>e.confidence-t.confidence)).map((e=>({value:e.normalizedURI,label:a.getByURI(e.normalizedURI).name})));const e=new Set(m.map((e=>e.value)));m=m.concat(a.filter((t=>!e.has(t.uri))).map((e=>({value:e.uri,label:e.name})))),void 0!==t&&t.depositTypeCandidate.length>0&&(h.fieldValue=t.depositTypeCandidate[0].normalizedURI,h.refDocURI=t.getFirstReferencedDocument().uri,h.refComment=t.reference[0].comment)}const p=q.a.uniqBy(o.flatMap((e=>Object.values(e.getReferencedDocuments()).map((e=>({key:e.uri,label:e.title||e.uri}))))),"uri");let v;return v="grade"===i||"tonnage"===i?Object(H.jsx)(re.a,{type:"number"}):"depositType"===i?Object(H.jsx)(V.a,{showSearch:!0,options:m,optionFilterProp:"label"}):Object(H.jsx)(le,{onProvenanceChange:l,options:u}),Object(H.jsx)(ae.a,{title:"Edit Mineral Site",width:"70%",open:void 0!==i,onCancel:()=>r(),footer:null,children:Object(H.jsxs)(ne.a,{form:c,onFinish:e=>{if(void 0===i)return;const t=c.getFieldsValue();let o;if("name"===i||"location"===i)o={field:i,value:t.fieldValue};else if("depositType"===i)o={field:i,observedName:a.getByURI(t.fieldValue).name,normalizedURI:t.fieldValue};else{if("grade"!==i&&"tonnage"!==i)throw new Error("Unknown field ".concat(i));o={field:i,value:parseFloat(t.fieldValue),commodity:n}}r({edit:o,reference:new O({document:new x({uri:t.refDocURI}),comment:t.refComment,property:t.refAppliedToAll?void 0:O.normalizeProperty(i)})})},layout:"vertical",style:{marginTop:24,marginBottom:24},requiredMark:!0,initialValues:h,children:[Object(H.jsx)(ne.a.Item,{name:"fieldValue",label:d,required:!0,tooltip:"This is a required field",rules:[{required:!0,message:"Value cannot be empty"}],children:v}),Object(H.jsx)(ne.a.Item,{name:"refDocURI",label:"Reference",required:!0,tooltip:"This is a required field",rules:[{required:!0,message:"Document URL"}],children:Object(H.jsx)(le,{onProvenanceChange:()=>{},options:p})}),Object(H.jsx)(ne.a.Item,{name:"refComment",label:"Comment",children:Object(H.jsx)(re.a.TextArea,{rows:3})}),Object(H.jsx)(ne.a.Item,{name:"refAppliedToAll",valuePropName:"checked",children:Object(H.jsx)(J.a,{children:"This reference applies to all fields"})}),Object(H.jsx)(ne.a.Item,{children:Object(H.jsxs)(L.a,{children:[Object(H.jsx)(Y.a,{type:"primary",htmlType:"submit",children:"Save"}),Object(H.jsx)(Y.a,{htmlType:"button",onClick:()=>r(),children:"Cancel"})]})})]})})};var me=o(52);const he={table:{"& .ant-table":{margin:"0px !important",border:"1px solid #ccc"}},editButton:{cursor:"pointer"},myEditedRow:{backgroundColor:"".concat(me.d[1]," !important"),"& > td":{backgroundColor:"".concat(me.d[1]," !important")}}},pe=Object(ee.a)(he)(Object(M.a)((e=>{let{dedupSite:t,commodity:o,classes:i}=e;const n=D(),{mineralSiteStore:r,userStore:a,dedupMineralSiteStore:c}=n,[l,u]=Object(s.useState)(void 0),[m,h]=Object(s.useState)(new Set),p=t.sites.map((e=>r.get(e))).filter((e=>void 0!==e)),v=p.filter((e=>null!==e)),y="updating"===r.state.value||p.length!==t.sites.length,g=async()=>{const e=[{sites:Array.from(m)},{sites:v.map((e=>e.id)).filter((e=>!m.has(e)))}],i=await c.updateSameAsGroup(e);if(o&&o.id){const e=o.id;await c.replaceSites([t.id],i,e),d.a.success("Ungrouping was successful!")}},f=Object(s.useMemo)((()=>[{title:"Select",key:"select",hidden:1===v.length,render:(e,t)=>Object(H.jsx)(J.a,{checked:m.has(t.id),onChange:e=>{const o=new Set(m);e.target.checked?o.add(t.id):o.delete(t.id),h(o)}})},{title:Object(H.jsxs)(E.a,{justify:"space-between",children:[Object(H.jsx)("span",{children:"Name"}),Object(H.jsx)($.a,{className:i.editButton,onClick:()=>u("name")})]}),key:"name",render:(e,t)=>Object(H.jsx)(G.a.Link,{href:t.uri,target:"_blank",children:t.name})},{title:Object(H.jsxs)(E.a,{justify:"space-between",children:[Object(H.jsx)("span",{children:"Location"}),Object(H.jsx)($.a,{className:i.editButton,onClick:()=>u("location")})]}),key:"location",render:(e,t)=>Object(H.jsx)(G.a.Text,{className:"font-small",ellipsis:!0,style:{maxWidth:200},children:t.locationInfo.location})},{title:"CRS",key:"crs",render:(e,t)=>{var o;return Object(H.jsx)("span",{children:null===(o=t.locationInfo.crs)||void 0===o?void 0:o.observedName})}},{title:"Country",key:"country",render:(e,t)=>Object(H.jsx)(oe,{entities:t.locationInfo.country})},{title:"State/Province",key:"state/province",render:(e,t)=>Object(H.jsx)(oe,{entities:t.locationInfo.stateOrProvince})},{title:Object(H.jsxs)(E.a,{justify:"space-between",children:[Object(H.jsx)("span",{children:"Dep. Type"}),Object(H.jsx)($.a,{className:i.editButton,onClick:()=>u("depositType")})]}),key:"deposit-type",render:(e,t)=>Object(H.jsx)(te,{entity:t.depositTypeCandidate[0]})},{title:"Dep. Confidence",key:"dep-type-confidence",render:(e,t)=>0===t.depositTypeCandidate.length?"-":t.depositTypeCandidate[0].confidence.toFixed(4)},{title:Object(H.jsxs)(E.a,{justify:"space-between",children:[Object(H.jsx)("span",{children:"Tonnage (Mt)"}),Object(H.jsx)($.a,{className:i.editButton,onClick:()=>u("tonnage")})]}),key:"tonnage",render:(e,t)=>{const i=t.gradeTonnage[o.id];return void 0===i||void 0===i.totalTonnage?"-":i.totalTonnage.toFixed(4)}},{title:Object(H.jsxs)(E.a,{justify:"space-between",children:[Object(H.jsx)("span",{children:"Grade (%)"}),Object(H.jsx)($.a,{className:i.editButton,onClick:()=>u("grade")})]}),key:"grade",render:(e,t)=>{const i=t.gradeTonnage[o.id];return void 0===i||void 0===i.totalGrade?"-":i.totalGrade.toFixed(2)}},{title:"Reference",key:"reference",render:(e,t)=>Object(H.jsx)(ve,{site:t})}]),[o.id,v.length,m,g]);Object(s.useEffect)((()=>{r.fetchByIds(t.sites)}),[r]);const j=v.find((e=>e.createdBy.includes(a.getCurrentUser().url)));let b;if(m.size>0&&v.length>1){const e=Object(H.jsx)(Y.a,{type:"primary",onClick:g,children:"Ungroup Separately"},"separately"),t=Object(H.jsx)(Y.a,{type:"primary",onClick:g,children:"Ungroup Together"},"together");b=1===m.size||m.size===v.length?[e]:[e,t],b=Object(H.jsx)(L.a,{children:b})}return Object(H.jsxs)(E.a,{vertical:!0,gap:"small",children:[b,Object(H.jsx)(Z.a,{className:i.table,bordered:!0,pagination:!1,size:"small",rowKey:"id",columns:f,dataSource:v,loading:y,rowClassName:e=>e.createdBy.includes(a.getCurrentUser().url)?i.myEditedRow:""}),Object(H.jsx)(ue,{sites:v,currentSite:j,editField:l,onFinish:e=>{if(void 0===e)return void u(void 0);const o=a.getCurrentUser(),i=v.find((e=>e.createdBy.includes(o.url)));let s;if(void 0===i){const i=I.fromMineralSite(n,t,v,o.id,e.reference);i.updateField(n,e.edit,e.reference),s=r.createAndUpdateDedup(t.commodity,i)}else{const o=new C(i);o.updateField(n,e.edit,e.reference),s=r.updateAndUpdateDedup(t.commodity,o)}s.then((()=>{u(void 0)}))},commodity:o.id},l)]})}))),ve=e=>{let{site:t}=e;const o=Object(s.useMemo)((()=>Object.values(t.getReferencedDocuments())),[t]);return Object(H.jsx)(G.a.Text,{ellipsis:!0,style:{maxWidth:200},children:ie(o.map((e=>Object(H.jsx)(G.a.Link,{target:"_blank",href:e.uri,children:e.title||e.uri},e.uri))),(e=>Object(H.jsx)("span",{children:"\xa0\xb7\xa0"},"sep-".concat(e))))})},ye=e=>{let{uri:t,store:o}=e;const i=D()[o],n=i.get(t);return null===n?Object(H.jsx)(G.a.Link,{href:t,target:"_blank",children:"Not found"}):void 0===n?(console.log({store:o,db:i,uri:t,record:n}),Object(H.jsx)(G.a.Link,{href:t,target:"_blank",children:"Loading..."})):Object(H.jsx)(G.a.Link,{href:t,target:"_blank",children:n.name})},ge={records:[],total:0},fe=Object(M.a)((e=>{let{commodity:t}=e;const{dedupMineralSiteStore:o,countryStore:i,stateOrProvinceStore:n}=D(),[r,a]=Object(s.useState)(void 0),[c,l]=Object(s.useState)(new Set),u=Object(s.useMemo)((()=>[{title:"Select",key:"select",render:(e,t)=>Object(H.jsx)(J.a,{onChange:e=>m(t,e.target.checked),checked:c.has(t.id)})},{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>Object(H.jsx)(G.a.Link,{href:t.uri,target:"_blank",children:t.name||"\u1806"}),sorter:(e,t)=>e.name.localeCompare(t.name)},{title:"Type",key:"type",render:(e,t)=>Object(H.jsx)("span",{className:"font-small",children:t.type}),sorter:(e,t)=>e.type.localeCompare(t.type)},{title:"Rank",key:"rank",render:(e,t)=>Object(H.jsx)("span",{className:"font-small",children:t.rank}),sorter:(e,t)=>e.rank.localeCompare(t.rank)},{title:"Location",key:"location",render:(e,t)=>void 0!==t.location&&void 0!==t.location.lat&&void 0!==t.location.lon?"".concat(t.location.lat.toFixed(5),", ").concat(t.location.lon.toFixed(5)):"\u1806",sorter:(e,t)=>{var o,i,n,r;const a=e.location?"".concat(null===(o=e.location.lat)||void 0===o?void 0:o.toFixed(3),",").concat(null===(i=e.location.lon)||void 0===i?void 0:i.toFixed(3)):"",s=t.location?"".concat(null===(n=t.location.lat)||void 0===n?void 0:n.toFixed(3),",").concat(null===(r=t.location.lon)||void 0===r?void 0:r.toFixed(3)):"";return a.localeCompare(s)}},{title:"Country",key:"country",render:(e,t)=>void 0===t.location||0===t.location.country.length?"\u1806":Object(H.jsx)(L.a,{split:Object(H.jsx)(X.a,{type:"vertical"}),children:t.location.country.map((e=>Object(H.jsx)(ye,{uri:e,store:"countryStore"},e)))}),sorter:(e,t)=>{var o,n;const r=(null===(o=e.location)||void 0===o?void 0:o.country.map((e=>i.getByURI(e).name)).join(","))||"",a=(null===(n=t.location)||void 0===n?void 0:n.country.map((e=>i.getByURI(e).name)).join(","))||"";return r.localeCompare(a)}},{title:"State/Province",key:"state",render:(e,t)=>void 0===t.location||0===t.location.stateOrProvince.length?"\u1806":Object(H.jsx)(L.a,{split:Object(H.jsx)(X.a,{type:"vertical"}),children:t.location.stateOrProvince.map((e=>Object(H.jsx)(ye,{uri:e,store:"stateOrProvinceStore"},e)))}),sorter:(e,t)=>{var o,i;const r=(null===(o=e.location)||void 0===o?void 0:o.stateOrProvince.map((e=>n.getByURI(e).name)).join(","))||"",a=(null===(i=t.location)||void 0===i?void 0:i.stateOrProvince.map((e=>n.getByURI(e).name)).join(","))||"";return r.localeCompare(a)}},{title:"Deposit Type",key:"depositType",render:(e,t)=>{const o=t.getTop1DepositType();return void 0===o?"\u1806":Object(H.jsx)(ye,{uri:o.uri,store:"depositTypeStore"})}},{title:"Dep. Score",key:"depositConfidence",render:(e,t)=>{const o=t.getTop1DepositType();return void 0===o?"\u1806":o.confidence.toFixed(4)}},{title:"Tonnage (Mt)",dataIndex:"totalTonnage",render:(e,t)=>void 0!==t.gradeTonnage&&void 0!==t.gradeTonnage.totalTonnage?t.gradeTonnage.totalTonnage.toFixed(4):"\u1806",sorter:(e,t)=>{var o,i;return((null===(o=e.gradeTonnage)||void 0===o?void 0:o.totalTonnage)||0)-((null===(i=t.gradeTonnage)||void 0===i?void 0:i.totalTonnage)||0)}},{title:"Grade (%)",dataIndex:"totalGrade",render:(e,t)=>void 0!==t.gradeTonnage&&void 0!==t.gradeTonnage.totalGrade?t.gradeTonnage.totalGrade.toFixed(2):"\u1806",sorter:(e,t)=>{var o,i;return((null===(o=e.gradeTonnage)||void 0===o?void 0:o.totalGrade)||0)-((null===(i=t.gradeTonnage)||void 0===i?void 0:i.totalGrade)||0)}},{title:"Action",key:"action",render:(e,t)=>Object(H.jsx)(L.a,{children:Object(H.jsx)(Y.a,{color:"primary",size:"middle",icon:Object(H.jsx)($.a,{}),variant:"filled",onClick:()=>{t.id===r?a(void 0):a(t.id)},children:"Edit"})})}]),[null===t||void 0===t?void 0:t.id,i,n,c,r]);Object(s.useEffect)((()=>{(async()=>{void 0!==t&&await o.fetchByCommodity(t)})()}),[t,o]);const m=(e,t)=>{const o=new Set(c);t?o.add(e.id):o.delete(e.id),l(o)},h="updating"===o.state.value,p=void 0===t||h?ge:o.getByCommodity(t);return Object(H.jsxs)(H.Fragment,{children:[c.size>0?[Object(H.jsx)("div",{children:Object(H.jsx)(Y.a,{type:"primary",onClick:async()=>{const e=Array.from(c),i=[{sites:Array.from(c).flatMap((e=>o.get(e).sites.map((e=>U.getId(e)))))}],n=await o.updateSameAsGroup(i);if(t&&t.id){const i=t.id;d.a.success("Grouping was successful",3),l(new Set),await o.replaceSites(e,n,i)}},disabled:1===c.size,children:"Group selected sites"})}),Object(H.jsx)(Z.a,{bordered:!0,size:"small",rowKey:"id",pagination:!1,columns:[{title:"Select",key:"group",render:(e,t)=>Object(H.jsx)(J.a,{type:"primary",checked:!0,onClick:()=>m(t,!1)})},...u.slice(1)],dataSource:Array.from(c).map((e=>o.get(e)))})]:[],Object(H.jsx)(Z.a,{bordered:!0,size:"small",rowKey:"id",columns:u,dataSource:p.records,loading:!!h&&{size:"large"},expandable:{expandedRowRender:e=>r===e.id?Object(H.jsx)(pe,{commodity:t,dedupSite:e}):null,showExpandColumn:!1,expandedRowKeys:[...r?[r]:[]]}})]})})),je=Object(M.a)((()=>{const[e,t,o]=function(){const{commodityStore:e}=D(),[t,o]=Object(s.useState)({commodity:void 0}),i=Object(s.useMemo)((()=>{if(void 0===t.commodity)return{commodity:void 0};const o=e.getByName(t.commodity);return{commodity:null===o?void 0:o}}),[e.records.size,t.commodity]);return[t,i,e=>{o(e)}]}();return Object(H.jsxs)(E.a,{vertical:!0,gap:"small",children:[Object(H.jsx)(Q,{searchArgs:e,setSearchArgs:o}),Object(H.jsx)(fe,{commodity:t.commodity})]})}));o(272);var be=o(178);const Oe={centerNavBar:{justifyContent:"center",boxShadow:"0 2px 8px #f0f1f2"},leftNavBar:{"& .logo::after":{borderBottom:"none !important",transition:"none !important"},"& .logo:hover::after":{borderBottom:"none !important",transition:"none !important"},"& .logo img":{height:24,borderRadius:4,marginTop:-2},paddingLeft:24,paddingRight:24,boxShadow:"0 2px 8px #f0f1f2"}},xe=(Object(ee.a)(Oe)((e=>{let{classes:t,menus:o,routes:i,className:n,style:a,isFirstItemLogo:s}=e;const c=Object(W.e)(),d=Object.keys(o).map(((e,t)=>Te(e,!0===s&&0===t?"logo":"",o[e]))),l=Object(r.i)(c,i);return Object(H.jsx)(be.a,{mode:"horizontal",className:t.centerNavBar+(void 0!==n?" "+n:""),style:a,onClick:e=>{i[e.key].path({},{}).open()},selectedKeys:void 0!==l?[l]:void 0,children:d})})),Object(ee.a)(Oe)((e=>{let{classes:t,menus:o,routes:i,className:n,style:a,isFirstItemLogo:s}=e;const c=Object(W.e)(),d=Object.keys(o).map(((e,t)=>Te(e,!0===s&&0===t?"logo":"",o[e]))),l=Object(r.i)(c,i);return Object(H.jsx)(be.a,{mode:"horizontal",className:t.leftNavBar+(void 0!==n?" "+n:""),style:a,onClick:e=>{i[e.key].path({},{}).open()},selectedKeys:void 0!==l?[l]:void 0,children:d})})));function Te(e,t,o){let i,n;if("string"===typeof o)i=o;else if(c.a.isValidElement(o))i=o;else{const{children:e,...t}=o;i=e,n=t}return Object(H.jsx)(be.a.Item,{className:t,...n,children:i},e)}const Se=Object(M.a)((e=>{let{children:t}=e;const{userStore:o}=D();return Object(s.useEffect)((()=>{o.isLoggedIn().then((e=>{e||we.login.path().open()}))}),[o]),t})),we={login:new r.c({component:()=>{const{userStore:e}=D(),[t,o]=Object(s.useState)(""),[i,n]=Object(s.useState)(""),[r,a]=Object(s.useState)("");Object(s.useEffect)((()=>{e.isLoggedIn().then((e=>{e&&we.home.path({commodity:void 0}).open()}))}),[e]);return Object(H.jsxs)("div",{className:"login-container",children:[Object(H.jsx)("h2",{children:"Login"}),Object(H.jsxs)("form",{onSubmit:async o=>{o.preventDefault();try{await e.login(t,i),we.home.path({commodity:void 0}).open()}catch(n){a("An error occurred. Please try again later.")}},className:"login-form",children:[Object(H.jsxs)("div",{className:"form-group",children:[Object(H.jsx)("label",{htmlFor:"username",children:"Username:"}),Object(H.jsx)("input",{type:"text",id:"username",value:t,onChange:e=>o(e.target.value),required:!0})]}),Object(H.jsxs)("div",{className:"form-group",children:[Object(H.jsx)("label",{htmlFor:"password",children:"Password:"}),Object(H.jsx)("input",{type:"password",id:"password",value:i,onChange:e=>n(e.target.value),required:!0})]}),r&&Object(H.jsx)("p",{className:"error-message",children:r}),Object(H.jsx)("button",{type:"submit",className:"login-button",children:"Login"})]})]})},pathDef:"".concat(m,"/login"),exact:!0}),home:new r.d({component:je,pathDef:"".concat(m,"/"),exact:!0,querySchema:{commodity:"optionalstring"}})};window._routes=we,Object(r.h)(we,(e=>t=>{const o=c.a.createElement(e,t);return Object(H.jsxs)(L.a,{direction:"vertical",style:{width:"100%"},children:[Object(H.jsx)(xe,{menus:{home:Object(H.jsx)("span",{children:"MinMod Editor"})},routes:we,isFirstItemLogo:!0}),Object(H.jsx)(Se,{children:Object(H.jsx)("div",{className:"wide-container",children:o})})]})}),["login"]);var Ie=o(222),Ce=o.n(Ie),Re=o(17);const ze=e=>{let{children:t}=e;return Object(s.useEffect)((()=>{Promise.all([F.depositTypeStore.fetchAll(),F.countryStore.fetchAll(),F.stateOrProvinceStore.fetchAll()])}),[]),t};Promise.resolve().then((()=>{n.a.render(Object(H.jsx)(A.Provider,{value:F,children:Object(H.jsx)(Re.a,{locale:Ce.a,children:Object(H.jsx)(ze,{children:Object(H.jsx)(r.a,{enUSLocale:!0,routes:we})})})}),document.getElementById("root"))})),a()}},[[281,1,2]]]);
//# sourceMappingURL=main.2ee94f7a.chunk.js.map