{"version":3,"sources":["reportWebVitals.ts","env.ts","models/user/UserStore.ts","models/commodity/CommodityStore.ts","models/depositType/DepositTypeStore.ts","models/country/CountryStore.ts","models/stateOrProvince/StateOrProvinceStore.ts","models/mineralSite/CandidateEntity.ts","models/mineralSite/GradeTonnage.ts","models/mineralSite/Reference.ts","models/mineralSite/MineralInventory.ts","models/mineralSite/MineralSite.ts","models/mineralSite/LocationInfo.ts","models/mineralSite/MineralSiteStore.ts","models/dedupMineralSite/DedupMineralSite.ts","models/dedupMineralSite/DedupMineralSiteStore.ts","models/Namespace.ts","models/index.ts","pages/home/SearchBar.tsx","pages/home/editDedupSite/CandidateEntity.tsx","misc/index.ts","components/EditableSelect.tsx","pages/home/editDedupSite/EditSiteField.tsx","pages/home/editDedupSite/EditDedupMineralSite.tsx","components/Entity.tsx","pages/home/DedupMineralSiteTable.tsx","pages/home/HomePage.tsx","components/Navbar.tsx","components/RequiredAuthentication.tsx","routes.tsx","pages/login/LoginPage.tsx","components/StoreInit.tsx","index.tsx"],"names":["reportWebVitals","onPerfEntry","Function","then","_ref","getCLS","getFID","getFCP","getLCP","getTTFB","process","REACT_APP_PLATFORM","SERVER","REACT_APP_API_SERVER","UserStore","RStore","constructor","super","concat","id","login","username","password","resp","axios","post","runInAction","this","set","deserialize","data","isLoggedIn","records","size","get","err","getCurrentUser","values","next","value","undefined","obj","email","name","url","CommodityStore","fetchCriticalCommotities","refetch","fetch","commodity","isCritical","push","getByName","uri","substring","lastIndexOf","is_critical","normRemoteSuccessfulResponse","items","total","DepositTypeStore","SingleKeyUniqueIndex","name2id","indices","uri2id","index","getByURI","fetchAll","CountryStore","country","StateOrProvinceStore","CandidateEntity","source","confidence","observedName","normalizedURI","clone","observed_name","normalized_uri","serialize","GradeTonnage","totalTonnage","totalGrade","totalContainedMetal","total_tonnage","total_grade","total_contained_metal","Reference","document","comment","property","Document","normalizeProperty","_ref2","title","MineralInventory","category","grade","ore","reference","fromGradeTonnage","stores","createdBy","gradeTonnage","commodityStore","map","Measure","unit","MineralSite","recordId","sourceId","locationInfo","depositTypeCandidate","sameAs","dedupSiteURI","mineralInventory","getReferencedDocuments","docs","ref","getFirstReferencedDocument","updateField","edit","field","location","Error","DraftCreateMineralSite","draftID","rest","fromMineralSite","dedupMineralSite","sites","_ref3","baseSite","filter","site","updateSourceId","DedupMineralSiteLocation","stateOrProvince","toLocationInfo","depositTypes","length","getTop1DepositType","toCandidateEntity","sourceType","sourceIdent","split","URL","searchParams","toString","DraftUpdateMineralSite","arguments","isSaved","markSaved","toModel","LocationInfo","crs","state_or_province","c","s","MineralSiteStore","CRUDStore","dedupMineralSiteStore","createAndUpdateDedup","draft","discardDraft","record","create","forceFetchByURI","updateAndUpdateDedup","update","record_id","source_id","dedup_site_uri","created_by","location_info","deposit_type_candidate","same_as","Object","fromEntries","grade_tonnage","val","gt","mineral_inventory","serializeRecord","_record$locationInfo$","console","log","cat","Array","isArray","DedupMineralSiteDepositType","_stores$depositTypeSt","depositTypeStore","lat","lon","loc","_stores$countryStore$","countryStore","_stores$stateOrProvin","stateOrProvinceStore","DedupMineralSite","type","rank","getId","deposit_types","depositType","DedupMineralSiteStore","ns","SingleKeyIndex","makeObservable","action","commodity2ids","state","remoteURL","params","error","response","status","fetchByCommodity","has","getByCommodity","conditions","MR","getURI","sop","BindedNamespace","prefix","namespace","MO","MD","userStore","mineralSiteStore","registerDefaultAxiosErrorHandler","message","window","_stores","toJS","StoreContext","createContext","useStores","React","useContext","SearchBar","searchArgs","setSearchArgs","options","setOptions","useState","useEffect","commodities","comm","label","_jsxs","Space","children","_jsx","Typography","Text","Select","style","width","placeholder","showSearch","optionFilterProp","onChange","CanEntComponent","entity","Link","href","target","ListCanEntComponent","entities","comp","i","_Fragment","join","arr","separator","result","EditableSelect","props","selectingValue","setSelectingValue","option","key","onClick","onProvenanceChange","Input","e","suffix","CloseCircleOutlined","color","Dropdown","menu","marginLeft","marginTop","DownOutlined","EditSiteField","currentSite","editField","onFinish","form","Form","useForm","useMemo","setFieldProvenance","setFieldValue","fieldValueOptions","fieldValueOptions2","initialValues","fieldValue","refDocURI","refComment","refAppliedToAll","_","uniqBy","flatMap","deptype","sort","a","b","predictedDepTypes","Set","doc","fieldValueComponent","Modal","open","onCancel","footer","getFieldsValue","parseFloat","layout","marginBottom","requiredMark","Item","required","tooltip","rules","TextArea","rows","valuePropName","Checkbox","Button","htmlType","css","table","margin","border","editButton","cursor","myEditedRow","backgroundColor","orange","EditDedupMineralSite","withStyles","observer","dedupSite","classes","setEditField","columns","Flex","justify","EditOutlined","className","render","ellipsis","maxWidth","_site$locationInfo$cr","toFixed","ReferenceComponent","fetchByIds","fetchedSites","isLoading","find","includes","Table","bordered","pagination","rowKey","dataSource","loading","rowClassName","change","currentUser","existingSite","cb","draftSite","Entity","store","db","emptyFetchResult","dataIndex","sorter","Divider","province","dt","DedupMineralSiteTable","editingDedupSite","setEditingDedupSite","Alert","description","showIcon","dedupMineralSites","icon","variant","UngroupOutlined","expandable","expandedRowRender","showExpandColumn","expandedRowKeys","HomePage","normSearchArgs","args","setArgs","normArgs","newArgs","useSearchArgs","vertical","gap","centerNavBar","justifyContent","boxShadow","leftNavBar","borderBottom","transition","height","borderRadius","paddingLeft","paddingRight","LeftNavBar","menus","routes","isFirstItemLogo","useLocation","keys","routeName","getMenuItem","activeRouteName","getActiveRouteName","Menu","mode","path","selectedKeys","realprops","isValidElement","children2","realprops2","RequiredAuthentication","NoArgsPathDef","component","LoginPage","setUsername","setPassword","setError","home","onSubmit","async","event","preventDefault","htmlFor","pathDef","exact","NoURLArgsPathDef","querySchema","_routes","applyLayout","element","createElement","direction","InitNonCriticalStores","Promise","all","resolve","ReactDOM","Provider","ConfigProvider","locale","enUSIntl","App","enUSLocale","getElementById"],"mappings":"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","file":"static/js/main.bde488f2.chunk.js","sourcesContent":["import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","export const THEME: \"dark\" | \"light\" = \"light\";\n\nexport const PLATFORM: \"native\" | \"web\" = process.env.REACT_APP_PLATFORM === \"native\" ? \"native\" : \"web\";\n\n// url of the API server\nexport const SERVER: string = process.env.REACT_APP_PLATFORM === \"native\" ? (process.env.REACT_APP_API_SERVER as string) : \"\";\n\n// path to the static directory for serving either local or remote css/js/assets\nexport const PUBLIC_URL: string = process.env.PUBLIC_URL;\n","import { RStore } from \"gena-app\";\nimport { SERVER } from \"../../env\";\nimport { runInAction } from \"mobx\";\nimport axios from \"axios\";\n\nexport interface User {\n  id: string;\n  url: string;\n  email: string;\n  name: string;\n}\n\nexport class UserStore extends RStore<string, User> {\n  constructor() {\n    super(`${SERVER}/api/v1`, { id: \"username\" }, false);\n  }\n\n  async login(username: string, password: string) {\n    let resp = await axios.post(`${SERVER}/api/v1/login`, { username, password });\n    return runInAction(() => {\n      this.set(this.deserialize(resp.data));\n    });\n  }\n\n  async isLoggedIn(): Promise<boolean> {\n    if (this.records.size > 0) {\n      return true;\n    }\n\n    try {\n      let resp = await axios.get(`${SERVER}/api/v1/whoami`);\n      runInAction(() => {\n        this.set(this.deserialize(resp.data));\n      });\n      return true;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  public getCurrentUser(): User | undefined {\n    if (this.records.size === 0) return undefined;\n    return this.records.values().next().value || undefined;\n  }\n\n  public deserialize(obj: any): User {\n    return {\n      id: obj.username,\n      email: obj.email,\n      name: obj.name,\n      url: `https://minmod.isi.edu/users/${obj.username}`,\n    };\n  }\n}\n","import { RStore, FetchResponse } from \"gena-app\";\nimport { SERVER } from \"../../env\";\n\nexport interface Commodity {\n  id: string; // not the URI, e.g. \"Q578\"\n  uri: string;\n  name: string;\n  isCritical: number;\n}\n\nexport class CommodityStore extends RStore<string, Commodity> {\n  constructor() {\n    super(`${SERVER}/api/v1/commodities`, undefined, false);\n  }\n\n  async fetchCriticalCommotities() {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n\n    const records = [];\n    for (const commodity of this.records.values()) {\n      if (commodity !== null && commodity.isCritical) {\n        records.push(commodity);\n      }\n    }\n    return records;\n  }\n\n  public getByName(name: string): Commodity | undefined | null {\n    if (this.records.size === 0) {\n      return undefined;\n    }\n\n    for (const commodity of this.records.values()) {\n      if (commodity !== null && commodity.name === name) {\n        return commodity;\n      }\n    }\n    return null;\n  }\n\n  public deserialize(obj: any): Commodity {\n    return {\n      id: obj.uri.substring(obj.uri.lastIndexOf(\"/\") + 1),\n      uri: obj.uri,\n      name: obj.name,\n      isCritical: obj.is_critical,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","import { RStore, FetchResponse, SingleKeyUniqueIndex } from \"gena-app\";\nimport { SERVER } from \"../../env\";\n\nexport interface DepositType {\n  id: string; // it is the URI\n  uri: string;\n  name: string;\n  environment: string;\n  group: string;\n}\n\nexport class DepositTypeStore extends RStore<string, DepositType> {\n  constructor() {\n    super(`${SERVER}/api/v1/deposit-types`, undefined, false, [new SingleKeyUniqueIndex(\"name\", \"id\"), new SingleKeyUniqueIndex(\"uri\", \"id\")]);\n  }\n\n  get name2id() {\n    return this.indices[0] as SingleKeyUniqueIndex<string, string, DepositType>;\n  }\n\n  get uri2id() {\n    return this.indices[1] as SingleKeyUniqueIndex<string, string, DepositType>;\n  }\n\n  public getByName(name: string): DepositType | undefined {\n    let id = this.name2id.index.get(name);\n    return id === undefined ? undefined : this.records.get(id)!;\n  }\n\n  public getByURI(uri: string): DepositType | undefined {\n    let id = this.uri2id.index.get(uri);\n    return id === undefined ? undefined : this.records.get(id)!;\n  }\n\n  async fetchAll(): Promise<void> {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n  }\n\n  public deserialize(obj: any): DepositType {\n    return {\n      ...obj,\n      id: obj.uri,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","import { RStore, FetchResponse } from \"gena-app\";\nimport { SERVER } from \"../../env\";\n\nexport interface Country {\n  id: string; // it is the URI\n  name: string;\n}\n\nexport class CountryStore extends RStore<string, Country> {\n  constructor() {\n    super(`${SERVER}/api/v1/countries`, undefined, false);\n  }\n\n  public getByURI(uri: string): Country | undefined {\n    const country = this.records.get(uri);\n    if (country === null) return undefined;\n    return country;\n  }\n\n  async fetchAll(): Promise<void> {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n  }\n\n  public deserialize(obj: any): Country {\n    return {\n      id: obj.uri,\n      name: obj.name,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","import { RStore, FetchResponse } from \"gena-app\";\nimport { SERVER } from \"../../env\";\n\nexport interface StateOrProvince {\n  id: string; // it is the URI\n  name: string;\n}\n\nexport class StateOrProvinceStore extends RStore<string, StateOrProvince> {\n  constructor() {\n    super(`${SERVER}/api/v1/states-or-provinces`, undefined, false);\n  }\n\n  public getByURI(uri: string): StateOrProvince | undefined {\n    const country = this.records.get(uri);\n    if (country === null) return undefined;\n    return country;\n  }\n\n  async fetchAll(): Promise<void> {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n  }\n\n  public deserialize(obj: any): StateOrProvince {\n    return {\n      id: obj.uri,\n      name: obj.name,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","export class CandidateEntity {\n  source: string;\n  confidence: number;\n  observedName?: string;\n  normalizedURI?: string;\n\n  public constructor({ source, confidence, observedName, normalizedURI }: { source: string; confidence: number; observedName?: string; normalizedURI?: string }) {\n    this.source = source;\n    this.confidence = confidence;\n    this.observedName = observedName;\n    this.normalizedURI = normalizedURI;\n  }\n\n  public clone(): CandidateEntity {\n    return new CandidateEntity({\n      source: this.source,\n      confidence: this.confidence,\n      observedName: this.observedName,\n      normalizedURI: this.normalizedURI,\n    });\n  }\n\n  public static deserialize(obj: any): CandidateEntity {\n    return new CandidateEntity({\n      source: obj.source,\n      confidence: obj.confidence,\n      observedName: obj.observed_name,\n      normalizedURI: obj.normalized_uri,\n    });\n  }\n\n  public serialize(): object {\n    return {\n      source: this.source,\n      confidence: this.confidence,\n      observed_name: this.observedName,\n      normalized_uri: this.normalizedURI,\n    };\n  }\n}\n","import { InternalID } from \"models/typing\";\n\nexport class GradeTonnage {\n  commodity: InternalID; // ID not URI\n  totalTonnage?: number;\n  totalGrade?: number;\n  totalContainedMetal?: number;\n\n  public constructor({ commodity, totalTonnage, totalGrade, totalContainedMetal }: { commodity: InternalID; totalTonnage?: number; totalGrade?: number; totalContainedMetal?: number }) {\n    this.commodity = commodity;\n    this.totalTonnage = totalTonnage;\n    this.totalGrade = totalGrade;\n    this.totalContainedMetal = totalContainedMetal;\n  }\n\n  public clone(): GradeTonnage {\n    return new GradeTonnage({\n      commodity: this.commodity,\n      totalTonnage: this.totalTonnage,\n      totalGrade: this.totalGrade,\n      totalContainedMetal: this.totalContainedMetal,\n    });\n  }\n\n  public static deserialize(obj: any): GradeTonnage {\n    return new GradeTonnage({\n      commodity: obj.commodity,\n      totalTonnage: obj.total_tonnage,\n      totalGrade: obj.total_grade,\n      totalContainedMetal: obj.total_contained_metal,\n    });\n  }\n}\n","export class Reference {\n  document: Document;\n  comment: string;\n  property?: string;\n  // pageInfo: PageInfo[];\n\n  public constructor({\n    document,\n    comment,\n    property,\n  }: {\n    document: Document;\n    comment: string;\n    property?: string;\n    // pageInfo: PageInfo[]\n  }) {\n    this.document = document;\n    this.comment = comment;\n    this.property = property;\n    // this.pageInfo = pageInfo;\n  }\n\n  public clone(): Reference {\n    return new Reference({\n      document: this.document.clone(),\n      comment: this.comment,\n      property: this.property,\n      // pageInfo: this.pageInfo\n    });\n  }\n\n  public static deserialize(obj: any): Reference {\n    obj = {\n      ...obj,\n      document: Document.deserialize(obj.document),\n    };\n    return new Reference(obj);\n  }\n\n  public serialize(): object {\n    return {\n      document: this.document.serialize(),\n      comment: this.comment,\n      property: this.property,\n      // pageInfo: this.pageInfo\n    };\n  }\n\n  public static normalizeProperty(property: \"name\" | \"location\" | \"depositType\" | \"grade\" | \"tonnage\"): string {\n    switch (property) {\n      case \"name\":\n        return \"http://www.w3.org/2000/01/rdf-schema#label\";\n      case \"location\":\n        return \"https://minmod.isi.edu/ontology/location\";\n      case \"depositType\":\n        return \"https://minmod.isi.edu/ontology/deposit_type\";\n      case \"grade\":\n        return \"https://minmod.isi.edu/ontology/grade\";\n      case \"tonnage\":\n        return \"https://minmod.isi.edu/ontology/ore\";\n      default:\n        return \"\";\n    }\n  }\n}\n\nexport class Document {\n  uri: string;\n  title?: string;\n\n  public constructor({ uri, title }: { uri: string; title?: string }) {\n    this.uri = uri;\n    this.title = title;\n  }\n\n  public clone(): Document {\n    return new Document({ uri: this.uri, title: this.title });\n  }\n  public static deserialize(obj: any): Document {\n    return new Document({\n      uri: obj.uri,\n      title: obj.title,\n    });\n  }\n  public serialize(): object {\n    return {\n      uri: this.uri,\n      title: this.title,\n    };\n  }\n}\n\n// export interface PageInfo {\n//   page: number;\n// }\n","import { IStore } from \"models\";\nimport { CandidateEntity } from \"./CandidateEntity\";\nimport { GradeTonnage } from \"./GradeTonnage\";\nimport { Reference } from \"./Reference\";\n\nexport class MineralInventory {\n  category: CandidateEntity[];\n  commodity: CandidateEntity;\n  grade?: Measure;\n  ore?: Measure;\n  reference: Reference;\n\n  public constructor({ category, commodity, grade, ore, reference }: { category: CandidateEntity[]; commodity: CandidateEntity; grade?: Measure; ore?: Measure; reference: Reference }) {\n    this.category = category;\n    this.commodity = commodity;\n    this.grade = grade;\n    this.ore = ore;\n    this.reference = reference;\n  }\n\n  public static fromGradeTonnage(stores: IStore, createdBy: string, gradeTonnage: GradeTonnage, reference: Reference): MineralInventory {\n    const commodity = stores.commodityStore.get(gradeTonnage.commodity)!;\n\n    return new MineralInventory({\n      category: [\"Inferred\", \"Indicated\", \"Measured\"].map(\n        (name) => new CandidateEntity({ source: createdBy, confidence: 1.0, observedName: name, normalizedURI: \"https://minmod.isi.edu/resource/\" + name })\n      ),\n      commodity: new CandidateEntity({\n        source: createdBy,\n        confidence: 1.0,\n        observedName: commodity.name,\n        normalizedURI: commodity.uri,\n      }),\n      grade:\n        gradeTonnage.totalGrade === undefined\n          ? undefined\n          : new Measure({\n              value: gradeTonnage.totalGrade,\n              unit: new CandidateEntity({\n                source: createdBy,\n                confidence: 1.0,\n                observedName: \"%\",\n                normalizedURI: \"https://minmod.isi.edu/resource/Q201\",\n              }),\n            }),\n      ore:\n        gradeTonnage.totalTonnage === undefined\n          ? undefined\n          : new Measure({\n              value: gradeTonnage.totalTonnage,\n              unit: new CandidateEntity({\n                source: createdBy,\n                confidence: 1.0,\n                observedName: \"%\",\n                normalizedURI: \"https://minmod.isi.edu/resource/Q202\",\n              }),\n            }),\n      reference: reference,\n    });\n  }\n\n  public static deserialize(obj: any): MineralInventory {\n    return new MineralInventory({\n      category: obj.category === undefined ? [] : obj.category.map(CandidateEntity.deserialize),\n      commodity: CandidateEntity.deserialize(obj.commodity),\n      grade: obj.grade === undefined ? undefined : Measure.deserialize(obj.grade),\n      ore: obj.ore === undefined ? undefined : Measure.deserialize(obj.ore),\n      reference: Reference.deserialize(obj.reference),\n    });\n  }\n}\n\nexport class Measure {\n  value: number;\n  unit: CandidateEntity;\n\n  public constructor({ value, unit }: { value: number; unit: CandidateEntity }) {\n    this.value = value;\n    this.unit = unit;\n  }\n\n  public static deserialize(obj: any): Measure {\n    return new Measure({\n      value: obj.value,\n      unit: CandidateEntity.deserialize(obj.unit),\n    });\n  }\n}\n","import { CandidateEntity } from \"./CandidateEntity\";\nimport { GradeTonnage } from \"./GradeTonnage\";\nimport { LocationInfo } from \"./LocationInfo\";\nimport { Reference, Document } from \"./Reference\";\nimport { DedupMineralSite, DedupMineralSiteLocation } from \"models/dedupMineralSite\";\nimport { DepositTypeStore } from \"models/depositType\";\nimport { StateOrProvinceStore } from \"models/stateOrProvince\";\nimport { CountryStore } from \"models/country\";\nimport { MineralInventory } from \"./MineralInventory\";\nimport { IStore } from \"models\";\nimport { InternalID } from \"models/typing\";\n\nexport type EditableField = \"name\" | \"location\" | \"depositType\" | \"grade\" | \"tonnage\";\nexport type FieldEdit =\n  | { field: \"name\"; value: string }\n  | { field: \"location\"; value: string }\n  | { field: \"depositType\"; observedName: string; normalizedURI: string }\n  | {\n      field: \"grade\";\n      value: number;\n      commodity: string;\n    }\n  | { field: \"tonnage\"; value: number; commodity: string };\n\nexport type MineralSiteConstructorArgs = {\n  id: InternalID;\n  recordId: string;\n  sourceId: string;\n  dedupSiteURI: string;\n  createdBy: string[];\n  name: string;\n  locationInfo: LocationInfo;\n  depositTypeCandidate: CandidateEntity[];\n  reference: Reference[];\n  sameAs: string[];\n  gradeTonnage: { [commodity: string]: GradeTonnage };\n  mineralInventory: MineralInventory[];\n};\n\nexport class MineralSite {\n  id: InternalID;\n  sourceId: string;\n  recordId: string;\n  dedupSiteURI: string;\n  createdBy: string[];\n  name: string;\n  locationInfo: LocationInfo;\n  depositTypeCandidate: CandidateEntity[];\n  reference: Reference[];\n  sameAs: string[];\n  gradeTonnage: { [commodity: string]: GradeTonnage };\n  mineralInventory: MineralInventory[];\n\n  public constructor({ id, recordId, sourceId, createdBy, name, locationInfo, depositTypeCandidate, reference, sameAs, gradeTonnage, dedupSiteURI, mineralInventory }: MineralSiteConstructorArgs) {\n    this.id = id;\n    this.recordId = recordId;\n    this.sourceId = sourceId;\n    this.dedupSiteURI = dedupSiteURI;\n    this.createdBy = createdBy;\n    this.name = name;\n    this.locationInfo = locationInfo;\n    this.depositTypeCandidate = depositTypeCandidate;\n    this.reference = reference;\n    this.sameAs = sameAs;\n    this.gradeTonnage = gradeTonnage;\n    this.mineralInventory = mineralInventory;\n  }\n\n  get uri(): string {\n    return `https://minmod.isi.edu/resource/${this.id}`;\n  }\n\n  getReferencedDocuments(): { [uri: string]: Document } {\n    const docs: { [uri: string]: Document } = {};\n    for (const ref of this.reference) {\n      docs[ref.document.uri] = ref.document;\n    }\n    return docs;\n  }\n\n  getFirstReferencedDocument(): Document {\n    return this.reference[0].document;\n  }\n\n  updateField(stores: IStore, edit: FieldEdit, reference: Reference) {\n    switch (edit.field) {\n      case \"name\":\n        this.name = edit.value;\n        break;\n      case \"location\":\n        this.locationInfo.location = edit.value;\n        break;\n      case \"depositType\":\n        this.depositTypeCandidate = [\n          new CandidateEntity({\n            source: this.createdBy[0], // this works because createdBy is a single item array for experts\n            confidence: 1.0,\n            normalizedURI: edit.normalizedURI,\n            observedName: edit.observedName,\n          }),\n        ];\n        break;\n      case \"grade\":\n        if (this.gradeTonnage[edit.commodity] === undefined) {\n          this.gradeTonnage[edit.commodity] = new GradeTonnage({\n            commodity: edit.commodity,\n            totalGrade: edit.value,\n            totalTonnage: 0.00001,\n          });\n        } else {\n          this.gradeTonnage[edit.commodity].totalGrade = edit.value;\n        }\n\n        this.mineralInventory = [MineralInventory.fromGradeTonnage(stores, this.createdBy[0], this.gradeTonnage[edit.commodity], reference)];\n        break;\n      case \"tonnage\":\n        if (this.gradeTonnage[edit.commodity] === undefined) {\n          this.gradeTonnage[edit.commodity] = new GradeTonnage({\n            commodity: edit.commodity,\n            totalTonnage: edit.value,\n            totalGrade: 0.00001,\n          });\n        } else {\n          this.gradeTonnage[edit.commodity].totalTonnage = edit.value;\n        }\n\n        this.mineralInventory = [MineralInventory.fromGradeTonnage(stores, this.createdBy[0], this.gradeTonnage[edit.commodity], reference)];\n        break;\n      default:\n        throw new Error(`Unknown edit: ${edit}`);\n    }\n\n    // TODO: fix me, we need to avoid duplicated reference\n    this.reference.push(reference);\n  }\n}\n\nexport class DraftCreateMineralSite extends MineralSite {\n  draftID: string;\n\n  constructor({ draftID, ...rest }: { draftID: string } & MineralSiteConstructorArgs) {\n    super(rest);\n    this.draftID = draftID;\n  }\n\n  public static fromMineralSite(\n    stores: { depositTypeStore: DepositTypeStore; stateOrProvinceStore: StateOrProvinceStore; countryStore: CountryStore },\n    dedupMineralSite: DedupMineralSite,\n    sites: MineralSite[],\n    username: string,\n    reference: Reference\n  ): DraftCreateMineralSite {\n    const baseSite = sites[0].id === dedupMineralSite.sites[0] ? sites[0] : sites.filter((site) => site.id === dedupMineralSite.sites[0])[0];\n    const createdBy = `https://minmod.isi.edu/users/${username}`;\n    const confidence = 1.0;\n\n    return new DraftCreateMineralSite({\n      draftID: `draft-${dedupMineralSite.id}`,\n      id: \"\", // backend does not care about uri as they will recalculate it\n      sourceId: DraftCreateMineralSite.updateSourceId(baseSite.sourceId, username),\n      recordId: baseSite.recordId,\n      dedupSiteURI: dedupMineralSite.uri,\n      createdBy: [createdBy],\n      name: dedupMineralSite.name,\n      locationInfo: (\n        dedupMineralSite.location ||\n        new DedupMineralSiteLocation({\n          country: [],\n          stateOrProvince: [],\n        })\n      )?.toLocationInfo(stores, createdBy, confidence),\n      depositTypeCandidate: dedupMineralSite.depositTypes.length > 0 ? [dedupMineralSite.getTop1DepositType()!.toCandidateEntity(stores)] : [],\n      reference: [reference],\n      sameAs: dedupMineralSite.sites,\n      gradeTonnage: {\n        [dedupMineralSite.gradeTonnage.commodity]: dedupMineralSite.gradeTonnage,\n      },\n      mineralInventory: [],\n    });\n  }\n\n  public static updateSourceId(sourceId: string, username: string): string {\n    const [sourceType, sourceIdent] = sourceId.split(\"::\", 2);\n    const url = new URL(sourceIdent);\n    url.searchParams.set(\"username\", username);\n    return `${sourceType}::${url.toString()}`;\n  }\n}\n\nexport class DraftUpdateMineralSite extends MineralSite {\n  isSaved: boolean = true;\n\n  updateField(stores: IStore, edit: FieldEdit, reference: Reference) {\n    super.updateField(stores, edit, reference);\n    this.isSaved = false;\n  }\n\n  markSaved() {\n    this.isSaved = true;\n  }\n\n  toModel(): MineralSite {\n    return new MineralSite(this);\n  }\n}\n","import { computed, makeObservable } from \"mobx\";\nimport { CandidateEntity } from \"./CandidateEntity\";\n\nexport class LocationInfo {\n  location?: string;\n  country: CandidateEntity[];\n  stateOrProvince: CandidateEntity[];\n  crs?: CandidateEntity;\n\n  public constructor({ country, stateOrProvince, location, crs }: { country: CandidateEntity[]; stateOrProvince: CandidateEntity[]; location?: string; crs?: CandidateEntity }) {\n    this.location = location;\n    this.country = country;\n    this.stateOrProvince = stateOrProvince;\n    this.crs = crs;\n  }\n\n  public static deserialize(obj: any) {\n    return new LocationInfo({\n      location: obj.location,\n      country: obj.country === undefined ? [] : obj.country.map(CandidateEntity.deserialize),\n      stateOrProvince: obj.state_or_province === undefined ? [] : obj.state_or_province.map(CandidateEntity.deserialize),\n      crs: obj.crs === undefined ? undefined : CandidateEntity.deserialize(obj.crs),\n    });\n  }\n\n  public clone(): LocationInfo {\n    return new LocationInfo({\n      location: this.location,\n      country: this.country.map((c) => c.clone()),\n      stateOrProvince: this.stateOrProvince.map((s) => s.clone()),\n      crs: this.crs ? this.crs.clone() : undefined,\n    });\n  }\n}\n","import { SERVER } from \"env\";\nimport { CRUDStore, FetchResponse } from \"gena-app\";\nimport { MineralSite, DraftCreateMineralSite, DraftUpdateMineralSite } from \"./MineralSite\";\nimport { LocationInfo } from \"./LocationInfo\";\nimport { CandidateEntity } from \"./CandidateEntity\";\nimport { Reference } from \"./Reference\";\nimport { GradeTonnage } from \"./GradeTonnage\";\nimport { DedupMineralSite, DedupMineralSiteStore } from \"models/dedupMineralSite\";\nimport { MineralInventory } from \"./MineralInventory\";\n\nexport class MineralSiteStore extends CRUDStore<string, DraftCreateMineralSite, DraftUpdateMineralSite, MineralSite> {\n  dedupMineralSiteStore: DedupMineralSiteStore;\n\n  constructor(dedupMineralSiteStore: DedupMineralSiteStore) {\n    super(`${SERVER}/api/v1/mineral-sites`, undefined, false);\n    this.dedupMineralSiteStore = dedupMineralSiteStore;\n  }\n\n  async createAndUpdateDedup(commodity: string, draft: DraftCreateMineralSite, discardDraft: boolean = true): Promise<MineralSite> {\n    const record = await this.create(draft, discardDraft);\n    await this.dedupMineralSiteStore.forceFetchByURI(record.dedupSiteURI, commodity);\n    return record;\n  }\n\n  async updateAndUpdateDedup(commodity: string, draft: DraftUpdateMineralSite, discardDraft: boolean = true): Promise<MineralSite> {\n    const record = await this.update(draft, discardDraft);\n    await this.dedupMineralSiteStore.forceFetchByURI(record.dedupSiteURI, commodity);\n    return record;\n  }\n\n  public deserialize(record: any): MineralSite {\n    return new MineralSite({\n      id: record.id,\n      recordId: record.record_id,\n      sourceId: record.source_id,\n      dedupSiteURI: record.dedup_site_uri,\n      createdBy: record.created_by,\n      name: record.name,\n      locationInfo:\n        record.location_info !== undefined\n          ? LocationInfo.deserialize(record.location_info)\n          : new LocationInfo({\n              country: [],\n              stateOrProvince: [],\n            }),\n      depositTypeCandidate: (record.deposit_type_candidate || []).map(CandidateEntity.deserialize),\n      reference: record.reference.map(Reference.deserialize),\n      sameAs: record.same_as,\n      gradeTonnage: Object.fromEntries(\n        record.grade_tonnage.map((val: any) => {\n          const gt = GradeTonnage.deserialize(val);\n          return [gt.commodity, gt];\n        })\n      ),\n      mineralInventory: record.mineral_inventory.map(MineralInventory.deserialize),\n    });\n  }\n\n  public serializeRecord(record: DraftCreateMineralSite | DraftUpdateMineralSite): object {\n    // convert mineral site to the format that the server required to save the mineral site.\n    // TODO: validate for the location\n    const reference = record.reference.map((ref) => ref.serialize());\n    let mineralInventory = [];\n\n    for (const gt of Object.values(record.gradeTonnage)) {\n      console.log(\"@@@\", gt);\n      mineralInventory.push({\n        // TODO: fix me! find correct source\n        // TODO: get correct users\n        category: [\"Inferred\", \"Indicated\", \"Measured\"].map((cat) => ({\n          source: record.createdBy[0],\n          confidence: 1.0,\n          normalized_uri: `https://minmod.isi.edu/resource/${cat}`,\n        })),\n        commodity: {\n          source: record.createdBy[0],\n          confidence: 1.0,\n          normalized_uri: `https://minmod.isi.edu/resource/${gt.commodity}`,\n        },\n        ore: {\n          value: gt.totalTonnage,\n          unit: {\n            source: record.createdBy[0],\n            confidence: 1.0,\n            normalized_uri: \"https://minmod.isi.edu/resource/Q202\",\n          },\n        },\n        grade: {\n          value: gt.totalGrade,\n          unit: {\n            source: record.createdBy[0],\n            confidence: 1.0,\n            normalized_uri: \"https://minmod.isi.edu/resource/Q201\",\n          },\n        },\n        reference: reference[0],\n      });\n    }\n\n    return {\n      name: record.name,\n      record_id: record.recordId,\n      source_id: record.sourceId,\n      created_by: record.createdBy,\n      dedup_site_uri: record.dedupSiteURI,\n      location_info: {\n        country: record.locationInfo.country.map((country) => country.serialize()),\n        state_or_province: record.locationInfo.stateOrProvince.map((state_or_province) => state_or_province.serialize()),\n        crs: record.locationInfo.crs?.serialize(),\n        location: record.locationInfo.location,\n      },\n      deposit_type_candidate: record.depositTypeCandidate.map((depositTypeCandidate) => depositTypeCandidate.serialize()),\n      mineral_inventory: mineralInventory,\n      reference: reference,\n      same_as: record.sameAs,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: Array.isArray(resp.data) ? resp.data : Object.values(resp.data), total: resp.total };\n  }\n}\n","import { CountryStore } from \"models/country\";\nimport { DepositTypeStore } from \"models/depositType\";\nimport { CandidateEntity, GradeTonnage, LocationInfo } from \"models/mineralSite\";\nimport { StateOrProvinceStore } from \"models/stateOrProvince\";\nimport { InternalID, IRI } from \"models/typing\";\n\nexport class DedupMineralSiteDepositType {\n  uri: IRI;\n  source: string;\n  confidence: number;\n\n  public constructor({ uri, source, confidence }: { uri: IRI; source: string; confidence: number }) {\n    this.uri = uri;\n    this.source = source;\n    this.confidence = confidence;\n  }\n\n  public toCandidateEntity(stores: { depositTypeStore: DepositTypeStore }): CandidateEntity {\n    return new CandidateEntity({\n      source: this.source,\n      confidence: this.confidence,\n      normalizedURI: this.uri,\n      observedName: stores.depositTypeStore.get(this.uri)?.name,\n    });\n  }\n}\n\nexport class DedupMineralSiteLocation {\n  lat?: number;\n  lon?: number;\n  country: IRI[];\n  stateOrProvince: IRI[];\n\n  public constructor({ lat, lon, country, stateOrProvince }: { lat?: number; lon?: number; country: IRI[]; stateOrProvince: IRI[] }) {\n    this.lat = lat;\n    this.lon = lon;\n    this.country = country;\n    this.stateOrProvince = stateOrProvince;\n  }\n\n  public static deserialize(record: any): DedupMineralSiteLocation {\n    return new DedupMineralSiteLocation({\n      lat: record.lat,\n      lon: record.lon,\n      country: record.country || [],\n      stateOrProvince: record.state_or_province || [],\n    });\n  }\n\n  public toLocationInfo(\n    stores: {\n      stateOrProvinceStore: StateOrProvinceStore;\n      countryStore: CountryStore;\n    },\n    source: string,\n    confidence: number = 1.0\n  ) {\n    let loc = undefined;\n    if (this.lat !== undefined && this.lon !== undefined) {\n      loc = `POINT (${this.lon} ${this.lat})`;\n    }\n\n    return new LocationInfo({\n      location: loc,\n      crs: new CandidateEntity({\n        source,\n        confidence,\n        normalizedURI: \"https://minmod.isi.edu/resource/Q701\",\n        observedName: \"EPSG:4326\",\n      }),\n      country: this.country.map((country) => {\n        return new CandidateEntity({\n          source,\n          confidence,\n          normalizedURI: country,\n          observedName: stores.countryStore.get(country)?.name,\n        });\n      }),\n      stateOrProvince: this.stateOrProvince.map((stateOrProvince) => {\n        return new CandidateEntity({\n          source,\n          confidence,\n          normalizedURI: stateOrProvince,\n          observedName: stores.stateOrProvinceStore.get(stateOrProvince)?.name,\n        });\n      }),\n    });\n  }\n}\n\nexport class DedupMineralSite {\n  id: InternalID;\n  uri: IRI;\n  name: string;\n  type: string;\n  rank: string;\n  sites: IRI[];\n  depositTypes: DedupMineralSiteDepositType[];\n  location?: DedupMineralSiteLocation;\n  gradeTonnage: GradeTonnage;\n\n  public constructor({\n    id,\n    uri,\n    name,\n    type,\n    rank,\n    sites,\n    depositTypes,\n    location,\n    gradeTonnage,\n  }: {\n    id: InternalID;\n    uri: IRI;\n    name: string;\n    type: string;\n    rank: string;\n    sites: string[];\n    depositTypes: DedupMineralSiteDepositType[];\n    location?: DedupMineralSiteLocation;\n    gradeTonnage: GradeTonnage;\n  }) {\n    this.id = id;\n    this.uri = uri;\n    this.name = name;\n    this.type = type;\n    this.rank = rank;\n    this.sites = sites;\n    this.depositTypes = depositTypes;\n    this.location = location;\n    this.gradeTonnage = gradeTonnage;\n  }\n\n  get commodity(): string {\n    return this.gradeTonnage.commodity;\n  }\n\n  public static getId(uri: string): string {\n    return uri.substring(uri.lastIndexOf(\"/\") + 1);\n  }\n\n  public static deserialize(record: any): DedupMineralSite {\n    return new DedupMineralSite({\n      id: record.id,\n      uri: `https://minmod.isi.edu/resource/${record.id}`,\n      name: record.name,\n      type: record.type,\n      rank: record.rank,\n      sites: record.sites,\n      depositTypes: record.deposit_types.map((depositType: any) => new DedupMineralSiteDepositType(depositType)),\n      location: record.location !== undefined ? DedupMineralSiteLocation.deserialize(record.location) : undefined,\n      gradeTonnage: GradeTonnage.deserialize(record.grade_tonnage),\n    });\n  }\n\n  public getTop1DepositType(): DedupMineralSiteDepositType | undefined {\n    return this.depositTypes[0];\n  }\n}\n","import { RStore, FetchResponse, FetchResult, SingleKeyIndex } from \"gena-app\";\nimport { SERVER } from \"../../env\";\nimport { Commodity } from \"models/commodity\";\nimport { DedupMineralSite, DedupMineralSiteDepositType, DedupMineralSiteLocation } from \"./DedupMineralSite\";\nimport axios from \"axios\";\nimport { action, makeObservable, runInAction } from \"mobx\";\nimport { NamespaceManager } from \"models/Namespace\";\nimport { GradeTonnage } from \"models/mineralSite\";\n\nexport class DedupMineralSiteStore extends RStore<string, DedupMineralSite> {\n  ns: NamespaceManager;\n\n  constructor(ns: NamespaceManager) {\n    super(`${SERVER}/api/v1/dedup-mineral-sites`, undefined, false, [new SingleKeyIndex(\"commodity\", \"id\")]);\n    this.ns = ns;\n\n    makeObservable(this, {\n      forceFetchByURI: action,\n    });\n  }\n\n  get commodity2ids() {\n    return this.indices[0] as SingleKeyIndex<string, string, DedupMineralSite>;\n  }\n\n  async forceFetchByURI(uri: string, commodity: string): Promise<DedupMineralSite | undefined> {\n    const id = DedupMineralSite.getId(uri);\n    try {\n      this.state.value = \"updating\";\n\n      let resp = await axios.get(`${this.remoteURL}/${id}`, {\n        params: { commodity },\n      });\n\n      return runInAction(() => {\n        let record = this.deserialize(resp.data);\n        this.records.set(record.id, record);\n        this.index(record);\n        this.state.value = \"updated\";\n\n        return this.records.get(record.id)!;\n      });\n    } catch (error: any) {\n      if (error.response && error.response.status === 404) {\n        // entity does not exist\n        runInAction(() => {\n          this.records.set(id, null);\n          this.state.value = \"updated\";\n        });\n        return undefined;\n      }\n\n      runInAction(() => {\n        this.state.value = \"error\";\n      });\n      throw error;\n    }\n  }\n\n  async fetchByCommodity(commodity: Commodity): Promise<FetchResult<DedupMineralSite>> {\n    if (!this.refetch && this.commodity2ids.index.has(commodity.id)) {\n      return this.getByCommodity(commodity);\n    }\n    return await this.fetch({\n      conditions: { commodity: commodity.id },\n    });\n  }\n\n  public getByCommodity(commodity: Commodity): FetchResult<DedupMineralSite> {\n    if (!this.commodity2ids.index.has(commodity.id)) {\n      return { records: [], total: 0 };\n    }\n\n    const records = [];\n    for (const id of this.commodity2ids.index.get(commodity.id)!) {\n      records.push(this.records.get(id)!);\n    }\n    return { records, total: records.length };\n  }\n\n  public deserialize(record: any): DedupMineralSite {\n    const MR = this.ns.MR;\n\n    return new DedupMineralSite({\n      id: record.id,\n      uri: MR.getURI(record.id),\n      name: record.name,\n      type: record.type,\n      rank: record.rank,\n      sites: record.sites,\n      depositTypes: record.deposit_types.map(\n        (depositType: any) =>\n          new DedupMineralSiteDepositType({\n            uri: MR.getURI(depositType.id),\n            source: depositType.source,\n            confidence: depositType.confidence,\n          })\n      ),\n      location:\n        record.location !== undefined\n          ? new DedupMineralSiteLocation({\n              lat: record.location.lat,\n              lon: record.location.lon,\n              country: (record.location.country || []).map((country: string) => MR.getURI(country)),\n              stateOrProvince: (record.location.state_or_province || []).map((sop: string) => MR.getURI(sop)),\n            })\n          : undefined,\n      gradeTonnage: GradeTonnage.deserialize(record.grade_tonnage),\n    });\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","import { InternalID, IRI } from \"./typing\";\n\nexport class BindedNamespace {\n  prefix: string;\n  namespace: string;\n\n  constructor(prefix: string, namespace: string) {\n    this.prefix = prefix;\n    this.namespace = namespace;\n  }\n\n  getURI(id: InternalID): IRI {\n    return `${this.namespace}${id}`;\n  }\n}\n\nexport class NamespaceManager {\n  MR: BindedNamespace = new BindedNamespace(\"mr\", \"https://minmod.isi.edu/resource/\");\n  MO: BindedNamespace = new BindedNamespace(\"mo\", \"https://minmod.isi.edu/ontology/\");\n  MD: BindedNamespace = new BindedNamespace(\"md\", \"https://minmod.isi.edu/ontology-derived/\");\n}\n","import React, { createContext } from \"react\";\nimport { message } from \"antd\";\nimport { registerDefaultAxiosErrorHandler } from \"gena-app\";\n\nimport { toJS } from \"mobx\";\nimport { User, UserStore } from \"./user\";\nimport { Commodity, CommodityStore } from \"./commodity\";\nimport { DepositType, DepositTypeStore } from \"./depositType\";\nimport { Country, CountryStore } from \"./country\";\nimport { StateOrProvince, StateOrProvinceStore } from \"./stateOrProvince\";\nimport { DedupMineralSite, DedupMineralSiteStore } from \"./dedupMineralSite\";\nimport { FieldEdit, EditableField, Reference, Document, GradeTonnage, CandidateEntity, DraftCreateMineralSite, DraftUpdateMineralSite, MineralSite, MineralSiteStore } from \"./mineralSite\";\nimport { NamespaceManager, BindedNamespace } from \"./Namespace\";\n\nconst namespaceManager = new NamespaceManager();\nconst dedupMineralSiteStore = new DedupMineralSiteStore(namespaceManager);\n\nexport const stores = {\n  userStore: new UserStore(),\n  commodityStore: new CommodityStore(),\n  dedupMineralSiteStore,\n  mineralSiteStore: new MineralSiteStore(dedupMineralSiteStore),\n  depositTypeStore: new DepositTypeStore(),\n  stateOrProvinceStore: new StateOrProvinceStore(),\n  countryStore: new CountryStore(),\n};\n\nregisterDefaultAxiosErrorHandler((error) => {\n  message.error(\"Error while talking with the server.\", 5);\n});\n\n(window as any)._stores = stores;\n(window as any).toJS = toJS;\nexport type IStore = Readonly<typeof stores>;\n\n/** Init the stores with essential information (e.g., loading the ui settings) needed to run the app */\nexport function initStores(): Promise<any> {\n  return Promise.resolve();\n}\n\nexport function initNonCriticalStores(): Promise<any> {\n  return Promise.all([stores.depositTypeStore.fetchAll(), stores.countryStore.fetchAll(), stores.stateOrProvinceStore.fetchAll()]);\n}\n\nexport const StoreContext = createContext<IStore>(stores);\n\nexport function useStores(): IStore {\n  return React.useContext(StoreContext);\n}\n\nexport { Document, DedupMineralSite, MineralSite, Reference, GradeTonnage, CandidateEntity, DraftCreateMineralSite, DraftUpdateMineralSite, BindedNamespace, NamespaceManager };\nexport type { FieldEdit, EditableField, Commodity, User, DepositType, Country, StateOrProvince };\n","import { ConsoleSqlOutlined } from \"@ant-design/icons\";\nimport { Select, Space, Typography } from \"antd\";\nimport _ from \"lodash\";\nimport { useStores, Commodity, IStore } from \"models\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useLocation } from \"react-router\";\nimport { routes } from \"routes\";\n\ninterface SearchBarProps {\n  searchArgs: SearchArgs;\n  setSearchArgs: (args: SearchArgs) => void;\n}\n\ninterface SearchArgs {\n  commodity?: string;\n}\n\ninterface NormSearchArgs {\n  commodity?: Commodity;\n}\n\nexport function useSearchArgs2(): [SearchArgs, NormSearchArgs, (newArgs: SearchArgs) => void] {\n  const { commodityStore } = useStores();\n  const queryParams = routes.home.useQueryParams();\n  const location = useLocation();\n\n  const [args, setArgs] = useState<SearchArgs>({\n    commodity: undefined,\n  });\n\n  console.log(\"call useSearchArgs\", args);\n\n  const updateSearchArgs = (newArgs: SearchArgs) => {\n    console.log(\"[real update] update search args\", newArgs, routes.home.getURL({ commodity: newArgs.commodity }));\n    setArgs(newArgs);\n    routes.home.path({ commodity: newArgs.commodity }).open();\n    // window._routeAPIs.history.push(\"/?commodity=Lithium\");\n  };\n\n  // sync with queries in the URL\n  useEffect(() => {\n    const inv = () => {\n      const newArgs = {\n        commodity: queryParams?.commodity,\n      };\n\n      if (newArgs.commodity !== undefined) {\n        const commodity = commodityStore.getByName(newArgs.commodity);\n        console.log(\"check commodity\", newArgs.commodity, commodity);\n        if (commodity === null) {\n          // does not exist\n          newArgs.commodity = undefined;\n        }\n      }\n\n      console.log(\"[useEffect] update search args\", \"new=\", newArgs, \"old=\", args, \"query=\", queryParams);\n      console.log(\"location\", location, \"search\", location.search);\n      if (!_.isEqual(newArgs, args)) {\n        updateSearchArgs(newArgs);\n      }\n    };\n    // inv();\n    setTimeout(inv, 1000);\n  }, [commodityStore.records.size, queryParams?.commodity]);\n\n  const normArgs: NormSearchArgs = useMemo(() => {\n    if (args.commodity === undefined) {\n      return {\n        commodity: undefined,\n      };\n    }\n    const commodity = commodityStore.getByName(args.commodity);\n    return {\n      commodity: commodity === null ? undefined : commodity,\n    };\n  }, [commodityStore.records.size, args.commodity]);\n\n  return [args, normArgs, updateSearchArgs];\n}\n\nexport function useSearchArgs(): [SearchArgs, NormSearchArgs, (newArgs: SearchArgs) => void] {\n  const { commodityStore } = useStores();\n  const [args, setArgs] = useState<SearchArgs>({\n    commodity: undefined,\n  });\n\n  const updateSearchArgs = (newArgs: SearchArgs) => {\n    setArgs(newArgs);\n  };\n\n  const normArgs: NormSearchArgs = useMemo(() => {\n    if (args.commodity === undefined) {\n      return {\n        commodity: undefined,\n      };\n    }\n    const commodity = commodityStore.getByName(args.commodity);\n    return {\n      commodity: commodity === null ? undefined : commodity,\n    };\n  }, [commodityStore.records.size, args.commodity]);\n\n  return [args, normArgs, updateSearchArgs];\n}\n\nexport const SearchBar: React.FC<SearchBarProps> = ({ searchArgs, setSearchArgs }) => {\n  const { commodityStore } = useStores();\n  const [options, setOptions] = useState<{ value: string; label: string }[]>([]);\n\n  useEffect(() => {\n    commodityStore.fetchCriticalCommotities().then((commodities) => {\n      setOptions(\n        commodities.map((comm) => ({\n          value: comm.id,\n          label: comm.name,\n        }))\n      );\n    });\n  }, [commodityStore]);\n\n  const onSelect = (value: string) => {\n    setSearchArgs({ commodity: commodityStore.get(value)!.name });\n  };\n\n  return (\n    <Space>\n      <Typography.Text>Commodity:</Typography.Text>\n      <Select style={{ width: 200 }} value={searchArgs.commodity} placeholder=\"Select a commodity\" showSearch={true} optionFilterProp=\"label\" onChange={onSelect} options={options} />\n    </Space>\n  );\n};\n","import { Typography } from \"antd\";\nimport { CandidateEntity } from \"models\";\n\ninterface CanEntCompProps {\n  entity?: CandidateEntity;\n}\n\ninterface ListCanEntProps {\n  entities: CandidateEntity[];\n}\n\nexport const CanEntComponent: React.FC<CanEntCompProps> = ({ entity }: CanEntCompProps) => {\n  if (entity === undefined) {\n    return <span>-</span>;\n  }\n\n  const name = entity.observedName === undefined ? \" \" : entity.observedName;\n  if (entity.normalizedURI !== undefined) {\n    return (\n      <Typography.Link href={entity.normalizedURI} target=\"_blank\">\n        {name}\n      </Typography.Link>\n    );\n  }\n\n  return <span>{name}</span>;\n};\n\nexport const ListCanEntComponent = ({ entities }: ListCanEntProps) => {\n  const comp = [];\n\n  if (entities.length > 0) {\n    comp.push(<CanEntComponent key={0} entity={entities[0]} />);\n  }\n\n  for (let i = 1; i < entities.length; i++) {\n    comp.push(<span>&nbsp;-&nbsp;</span>);\n    comp.push(<CanEntComponent key={i} entity={entities[i]} />);\n  }\n\n  return <>{comp}</>;\n};\n","export function join<T>(arr: T[], separator: (index: number) => T): T[] {\n  if (arr.length === 0) {\n    return [];\n  }\n\n  const result: T[] = [arr[0]];\n  for (let i = 1; i < arr.length; i++) {\n    result.push(separator(i));\n    result.push(arr[i]);\n  }\n  return result;\n}\n","import { Dropdown, Input, MenuProps, Space } from \"antd\";\nimport { DownOutlined, SmileOutlined, UserOutlined, CloseCircleOutlined } from \"@ant-design/icons\";\nimport { useState } from \"react\";\n\nexport interface EditableSelectOption {\n  key: string;\n  label: string;\n}\n\nexport interface EditableSelectProps {\n  value?: string;\n  onChange?: (value: string) => void;\n  onProvenanceChange: (key: string | undefined) => void;\n  options: EditableSelectOption[];\n}\n\n/**\n * First time, it shows the dropdown with predefined options.\n *\n * User can select one of the predefined options, but when they click again, the dropdown\n * won't show up. User has a button to clean up the value. When they do that, the dropdown will\n * show up again.\n *\n * When user selects \"Enter your own\", the dropdown will disappear and an input field will show up.\n *\n * @param props\n * @returns\n */\nexport const EditableSelect: React.FC<EditableSelectProps> = (props) => {\n  const [selectingValue, setSelectingValue] = useState(false);\n  const items: MenuProps[\"items\"] = props.options.map((option) => ({\n    key: option.key,\n    label: option.label,\n    onClick: () => {\n      setSelectingValue(true);\n      if (props.onChange !== undefined) props.onChange(option.label);\n      props.onProvenanceChange(option.key);\n    },\n  }));\n  items.push({ type: \"divider\" });\n  items.push({\n    key: \"new\",\n    label: \"Enter your own\",\n    onClick: () => {\n      setSelectingValue(true);\n      props.onProvenanceChange(undefined);\n      if (props.onChange !== undefined) props.onChange(\"\");\n    },\n  });\n\n  if (selectingValue) {\n    return (\n      <Input\n        value={props.value}\n        onChange={(e) => (props.onChange !== undefined ? props.onChange(e.target.value) : undefined)}\n        placeholder={\"Enter your own\"}\n        suffix={\n          <CloseCircleOutlined\n            style={{ color: \"rgba(0,0,0,.25)\" }}\n            onClick={() => {\n              setSelectingValue(false);\n              if (props.onChange !== undefined) props.onChange(\"\");\n            }}\n          />\n        }\n      />\n    );\n  }\n\n  // Update React will solve the update state of unmounted component warnings\n  // https://github.com/ant-design/ant-design/issues/44994\n  return (\n    <Dropdown menu={{ items, style: { marginLeft: -12, marginTop: 8 } }}>\n      <Input value={props.value} placeholder={\"Select an option or enter your own\"} suffix={<DownOutlined style={{ color: \"rgba(0,0,0,.25)\" }} />} />\n    </Dropdown>\n  );\n};\n","import { Button, Checkbox, Form, Input, Modal, Select, Space } from \"antd\";\nimport { EditableSelect, EditableSelectOption } from \"components/EditableSelect\";\nimport _ from \"lodash\";\nimport { MineralSite, Reference, Document, FieldEdit, EditableField, useStores } from \"models\";\nimport { useMemo } from \"react\";\n\ninterface EditSiteFieldProps {\n  sites: MineralSite[];\n  currentSite?: MineralSite;\n  commodity: string;\n  editField?: EditableField;\n  onFinish: (change?: { edit: FieldEdit; reference: Reference }) => void;\n}\n\ntype FormFields = {\n  fieldValue: string;\n  refDocURI: string;\n  refComment: string;\n  refAppliedToAll: boolean;\n};\n\nexport const EditSiteField: React.FC<EditSiteFieldProps> = ({ currentSite, sites, editField, commodity, onFinish }) => {\n  const { depositTypeStore } = useStores();\n  const [form] = Form.useForm<FormFields>();\n\n  const title = useMemo(() => {\n    switch (editField) {\n      case \"name\":\n        return \"Name\";\n      case \"location\":\n        return \"Location\";\n      case \"depositType\":\n        return \"Deposit Type\";\n      case \"grade\":\n        return \"Grade (%)\";\n      case \"tonnage\":\n        return \"Tonnage (Mt)\";\n      default:\n        return \"\";\n    }\n  }, [editField]);\n\n  const setFieldProvenance = (key: string | undefined) => {\n    if (key !== undefined) {\n      const site = sites.filter((site) => site.id === key)[0];\n      // there can be multiple docs per site, we choose the first one and\n      // users can correct it.\n      form.setFieldValue(\"refDocURI\", site.getFirstReferencedDocument().uri);\n    } else {\n      form.setFieldValue(\"refDocURI\", \"\");\n    }\n  };\n\n  let fieldValueOptions: EditableSelectOption[] = [];\n  let fieldValueOptions2: { value: string; label: string }[] = [];\n  let initialValues = {\n    fieldValue: \"\",\n    refDocURI: \"\",\n    refComment: \"\",\n    refAppliedToAll: true,\n  };\n\n  if (editField === \"name\") {\n    fieldValueOptions = sites.map((site) => ({ key: site.id, label: site.name }));\n    if (currentSite !== undefined) {\n      initialValues.fieldValue = currentSite.name;\n      initialValues.refDocURI = currentSite.getFirstReferencedDocument().uri;\n      initialValues.refComment = currentSite.reference[0].comment;\n    }\n  } else if (editField === \"location\") {\n    fieldValueOptions = sites.filter((site) => site.locationInfo.location !== undefined).map((site) => ({ key: site.id, label: site.locationInfo.location! }));\n    if (currentSite !== undefined) {\n      initialValues.fieldValue = currentSite.locationInfo.location || \"\";\n      initialValues.refDocURI = currentSite.getFirstReferencedDocument().uri;\n      initialValues.refComment = currentSite.reference[0].comment;\n    }\n  } else if (editField === \"depositType\") {\n    fieldValueOptions2 = _.uniqBy(\n      sites.flatMap((site) => site.depositTypeCandidate).filter((deptype) => deptype.normalizedURI !== undefined),\n      \"normalizedURI\"\n    )\n      .sort((a, b) => a.confidence - b.confidence)\n      .map((type) => ({ value: type.normalizedURI!, label: depositTypeStore.getByURI(type.normalizedURI!)!.name }));\n\n    const predictedDepTypes = new Set(fieldValueOptions2.map((type) => type.value));\n    fieldValueOptions2 = fieldValueOptions2.concat(depositTypeStore.filter((type) => !predictedDepTypes.has(type.uri)).map((type) => ({ value: type.uri, label: type.name })));\n\n    if (currentSite !== undefined && currentSite.depositTypeCandidate.length > 0) {\n      initialValues.fieldValue = currentSite.depositTypeCandidate[0].normalizedURI!;\n      initialValues.refDocURI = currentSite.getFirstReferencedDocument().uri;\n      initialValues.refComment = currentSite.reference[0].comment;\n    }\n  }\n\n  const docs = _.uniqBy(\n    sites.flatMap((site) => Object.values(site.getReferencedDocuments()).map((doc) => ({ key: doc.uri, label: doc.title || doc.uri }))),\n    \"uri\"\n  );\n\n  const onSave = (values: any) => {\n    if (editField === undefined) return;\n    const val = form.getFieldsValue();\n    let edit;\n    if (editField === \"name\" || editField === \"location\") {\n      edit = { field: editField, value: val.fieldValue };\n    } else if (editField === \"depositType\") {\n      edit = { field: editField, observedName: depositTypeStore.getByURI(val.fieldValue)!.name, normalizedURI: val.fieldValue };\n    } else if (editField === \"grade\" || editField === \"tonnage\") {\n      edit = { field: editField, value: parseFloat(val.fieldValue), commodity };\n    } else {\n      throw new Error(`Unknown field ${editField}`);\n    }\n\n    onFinish({\n      edit,\n      reference: new Reference({\n        document: new Document({ uri: val.refDocURI }),\n        comment: val.refComment,\n        property: val.refAppliedToAll ? undefined : Reference.normalizeProperty(editField),\n      }),\n    });\n  };\n\n  let fieldValueComponent;\n  if (editField === \"grade\" || editField === \"tonnage\") {\n    fieldValueComponent = <Input type=\"number\" />;\n  } else if (editField === \"depositType\") {\n    fieldValueComponent = <Select showSearch={true} options={fieldValueOptions2} optionFilterProp=\"label\" />;\n  } else {\n    fieldValueComponent = <EditableSelect onProvenanceChange={setFieldProvenance} options={fieldValueOptions} />;\n  }\n\n  return (\n    <Modal title=\"Edit Mineral Site\" width=\"70%\" open={editField !== undefined} onCancel={() => onFinish()} footer={null}>\n      <Form form={form} onFinish={onSave} layout=\"vertical\" style={{ marginTop: 24, marginBottom: 24 }} requiredMark={true} initialValues={initialValues}>\n        <Form.Item<FormFields> name=\"fieldValue\" label={title} required={true} tooltip=\"This is a required field\" rules={[{ required: true, message: \"Value cannot be empty\" }]}>\n          {fieldValueComponent}\n        </Form.Item>\n        <Form.Item<FormFields> name=\"refDocURI\" label=\"Reference\" required={true} tooltip=\"This is a required field\" rules={[{ required: true, message: \"Document URL\" }]}>\n          <EditableSelect onProvenanceChange={() => {}} options={docs} />\n        </Form.Item>\n        <Form.Item<FormFields> name=\"refComment\" label=\"Comment\">\n          <Input.TextArea rows={3} />\n        </Form.Item>\n        <Form.Item<FormFields> name=\"refAppliedToAll\" valuePropName=\"checked\">\n          <Checkbox>This reference applies to all fields</Checkbox>\n        </Form.Item>\n        <Form.Item<FormFields>>\n          <Space>\n            <Button type=\"primary\" htmlType=\"submit\">\n              Save\n            </Button>\n            <Button htmlType=\"button\" onClick={() => onFinish()}>\n              Cancel\n            </Button>\n          </Space>\n        </Form.Item>\n      </Form>\n    </Modal>\n  );\n};\n","import { Button, Col, Flex, Row, Select, Space, Table, Typography } from \"antd\";\nimport { toJS } from \"mobx\";\nimport { observer } from \"mobx-react\";\nimport { useStores, Commodity, DedupMineralSite, MineralSite, CandidateEntity, Reference, DraftCreateMineralSite, FieldEdit, EditableField, DraftUpdateMineralSite } from \"models\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { WithStyles, withStyles } from \"@material-ui/styles\";\nimport { CanEntComponent, ListCanEntComponent } from \"./CandidateEntity\";\nimport { join } from \"misc\";\nimport { EditOutlined } from \"@ant-design/icons\";\nimport { EditSiteField } from \"./EditSiteField\";\nimport { orange } from \"@ant-design/colors\";\n\nconst css = {\n  table: {\n    \"& .ant-table\": {\n      margin: \"0px !important\",\n      border: \"1px solid #ccc\",\n    },\n  },\n  editButton: {\n    cursor: \"pointer\",\n  },\n  myEditedRow: {\n    backgroundColor: `${orange[1]} !important`,\n    \"& > td\": {\n      backgroundColor: `${orange[1]} !important`,\n    },\n  },\n};\n\ninterface EditDedupMineralSiteProps {\n  commodity: Commodity;\n  dedupSite: DedupMineralSite;\n}\n\nexport const EditDedupMineralSite = withStyles(css)(\n  observer(({ dedupSite, commodity, classes }: EditDedupMineralSiteProps & WithStyles<typeof css>) => {\n    const stores = useStores();\n    const { mineralSiteStore, userStore } = stores;\n    const [editField, setEditField] = useState<EditableField | undefined>(undefined);\n\n    const columns = useMemo(() => {\n      return [\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Name</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"name\")} />\n            </Flex>\n          ),\n          key: \"name\",\n          render: (_: any, site: MineralSite) => {\n            return (\n              <Typography.Link href={site.uri} target=\"_blank\">\n                {site.name}\n              </Typography.Link>\n            );\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Location</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"location\")} />\n            </Flex>\n          ),\n          key: \"location\",\n          render: (_: any, site: MineralSite) => {\n            return (\n              <Typography.Text className=\"font-small\" ellipsis={true} style={{ maxWidth: 200 }}>\n                {site.locationInfo.location}\n              </Typography.Text>\n            );\n          },\n        },\n        {\n          title: \"CRS\",\n          key: \"crs\",\n          render: (_: any, site: MineralSite) => {\n            return <span>{site.locationInfo.crs?.observedName}</span>;\n          },\n        },\n        {\n          title: \"Country\",\n          key: \"country\",\n          render: (_: any, site: MineralSite) => {\n            return <ListCanEntComponent entities={site.locationInfo.country} />;\n          },\n        },\n        {\n          title: \"State/Province\",\n          key: \"state/province\",\n          render: (_: any, site: MineralSite) => {\n            return <ListCanEntComponent entities={site.locationInfo.stateOrProvince} />;\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Dep. Type</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"depositType\")} />\n            </Flex>\n          ),\n          key: \"deposit-type\",\n          render: (_: any, site: MineralSite) => {\n            return <CanEntComponent entity={site.depositTypeCandidate[0]} />;\n          },\n        },\n        {\n          title: \"Dep. Confidence\",\n          key: \"dep-type-confidence\",\n          render: (_: any, site: MineralSite) => {\n            if (site.depositTypeCandidate.length === 0) {\n              return \"-\";\n            }\n            return site.depositTypeCandidate[0].confidence.toFixed(4);\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Tonnage (Mt)</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"tonnage\")} />\n            </Flex>\n          ),\n          key: \"tonnage\",\n          render: (_: any, site: MineralSite) => {\n            const gradeTonnage = site.gradeTonnage[commodity.id];\n            if (gradeTonnage === undefined || gradeTonnage.totalTonnage === undefined) {\n              return \"-\";\n            }\n            return gradeTonnage.totalTonnage.toFixed(4);\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Grade (%)</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"grade\")} />\n            </Flex>\n          ),\n          key: \"grade\",\n          render: (_: any, site: MineralSite) => {\n            const gradeTonnage = site.gradeTonnage[commodity.id];\n            if (gradeTonnage === undefined || gradeTonnage.totalGrade === undefined) {\n              return \"-\";\n            }\n            return gradeTonnage.totalGrade.toFixed(2);\n          },\n        },\n        {\n          title: \"Reference\",\n          key: \"reference\",\n          render: (_: any, site: MineralSite) => {\n            return <ReferenceComponent site={site} />;\n          },\n        },\n      ];\n    }, [commodity.id]);\n\n    useEffect(() => {\n      mineralSiteStore.fetchByIds(dedupSite.sites);\n    }, [mineralSiteStore]);\n\n    const tmpLst: (MineralSite | null | undefined)[] = dedupSite.sites.map((id) => mineralSiteStore.get(id));\n    // no idea why typescript compiler incorrectly complains about the incorrect type\n    const fetchedSites = tmpLst.filter((site) => site !== undefined) as (MineralSite | null)[];\n    const sites = fetchedSites.filter((site) => site !== null) as MineralSite[];\n    const isLoading = mineralSiteStore.state.value === \"updating\" || fetchedSites.length !== dedupSite.sites.length;\n\n    const onEditFinish = (change?: { edit: FieldEdit; reference: Reference }) => {\n      if (change === undefined) {\n        setEditField(undefined);\n        return;\n      }\n\n      const currentUser = userStore.getCurrentUser()!;\n      const existingSite = sites.find((site) => site.createdBy.includes(currentUser.url));\n      let cb;\n      if (existingSite === undefined) {\n        const draftSite = DraftCreateMineralSite.fromMineralSite(stores, dedupSite, sites, currentUser.id, change.reference);\n        draftSite.updateField(stores, change.edit, change.reference);\n        cb = mineralSiteStore.createAndUpdateDedup(dedupSite.commodity, draftSite);\n      } else {\n        const draftSite = new DraftUpdateMineralSite(existingSite);\n        draftSite.updateField(stores, change.edit, change.reference);\n        cb = mineralSiteStore.updateAndUpdateDedup(dedupSite.commodity, draftSite);\n      }\n\n      cb.then(() => {\n        setEditField(undefined);\n      });\n    };\n\n    const currentSite = sites.find((site) => site.createdBy.includes(userStore.getCurrentUser()!.url));\n\n    return (\n      <>\n        <Table<MineralSite>\n          className={classes.table}\n          bordered={true}\n          pagination={false}\n          size=\"small\"\n          rowKey=\"id\"\n          columns={columns}\n          dataSource={sites}\n          loading={isLoading}\n          rowClassName={(site) => {\n            return site.createdBy.includes(userStore.getCurrentUser()!.url) ? classes.myEditedRow : \"\";\n          }}\n        />\n        <EditSiteField key={editField} sites={sites} currentSite={currentSite} editField={editField} onFinish={onEditFinish} commodity={commodity.id} />\n      </>\n    );\n  })\n) as React.FC<EditDedupMineralSiteProps>;\n\nconst ReferenceComponent: React.FC<{ site: MineralSite }> = ({ site }) => {\n  const docs = useMemo(() => {\n    return Object.values(site.getReferencedDocuments());\n  }, [site]);\n\n  return (\n    <Typography.Text ellipsis={true} style={{ maxWidth: 200 }}>\n      {join(\n        docs.map((doc) => (\n          <Typography.Link key={doc.uri} target=\"_blank\" href={doc.uri}>\n            {doc.title || doc.uri}\n          </Typography.Link>\n        )),\n        (index) => (\n          <span key={`sep-${index}`}>&nbsp;·&nbsp;</span>\n        )\n      )}\n    </Typography.Text>\n  );\n};\n","import { Typography } from \"antd\";\nimport { stores, useStores } from \"models\";\n\nexport interface EntityProps {\n  uri: string;\n  store: \"countryStore\" | \"commodityStore\" | \"depositTypeStore\" | \"stateOrProvinceStore\";\n}\n\nexport const Entity: React.FC<EntityProps> = ({ uri: uri, store }) => {\n  const db = useStores()[store];\n  const record = db.get(uri);\n\n  if (record === null) {\n    return (\n      <Typography.Link href={uri} target=\"_blank\">\n        Not found\n      </Typography.Link>\n    );\n  }\n\n  if (record === undefined) {\n    console.log({ store, db, uri, record });\n    return (\n      <Typography.Link href={uri} target=\"_blank\">\n        Loading...\n      </Typography.Link>\n    );\n  }\n\n  return (\n    <Typography.Link href={uri} target=\"_blank\">\n      {record.name}\n    </Typography.Link>\n  );\n};\n","import { DedupMineralSite, useStores } from \"models\";\nimport { useEffect, useState } from \"react\";\nimport { observer } from \"mobx-react\";\nimport { Commodity } from \"models/commodity\";\nimport { Alert, Button, Checkbox, Divider, Flex, Space, Spin, Table, Typography } from \"antd\";\nimport { FetchResult } from \"gena-app\";\nimport { EditOutlined, UngroupOutlined } from \"@ant-design/icons\";\nimport { EditDedupMineralSite } from \"./editDedupSite/EditDedupMineralSite\";\nimport { Entity } from \"components/Entity\";\n\ninterface DedupMineralSiteTableProps {\n  commodity: Commodity | undefined;\n}\n\nconst emptyFetchResult = { records: [], total: 0 };\n\nconst columns = [\n  {\n    title: \"Select\",\n    key: \"select\",\n    render: () => <Checkbox />,\n  },\n  {\n    title: \"Name\",\n    dataIndex: \"name\",\n    key: \"name\",\n    render: (_: any, site: DedupMineralSite) => {\n      return (\n        <Typography.Link href={site.uri} target=\"_blank\">\n          {site.name}\n        </Typography.Link>\n      );\n    },\n    sorter: true,\n  },\n  {\n    title: \"Type\",\n    key: \"type\",\n    render: (_: any, site: DedupMineralSite) => {\n      return <span className=\"font-small\">{site.type}</span>;\n    },\n  },\n  {\n    title: \"Rank\",\n    key: \"rank\",\n    render: (_: any, site: DedupMineralSite) => {\n      return <span className=\"font-small\">{site.rank}</span>;\n    },\n  },\n  {\n    title: \"Location\",\n    key: \"location\",\n    render: (value: any, dedupSite: DedupMineralSite) => {\n      if (dedupSite.location !== undefined && dedupSite.location.lat !== undefined && dedupSite.location.lon !== undefined) {\n        return `${dedupSite.location.lat.toFixed(5)}, ${dedupSite.location.lon.toFixed(5)}`;\n      }\n      return \"-\";\n    },\n  },\n  {\n    title: \"Country\",\n    key: \"country\",\n    render: (_: any, site: DedupMineralSite) => {\n      if (site.location === undefined) {\n        return \"-\";\n      }\n\n      return (\n        <Space split={<Divider type=\"vertical\" />}>\n          {site.location.country.map((country) => (\n            <Entity key={country} uri={country} store=\"countryStore\" />\n          ))}\n        </Space>\n      );\n    },\n  },\n  {\n    title: \"State/Province\",\n    key: \"state\",\n    render: (_: any, site: DedupMineralSite) => {\n      if (site.location === undefined) {\n        return \"-\";\n      }\n\n      return (\n        <Space split={<Divider type=\"vertical\" />}>\n          {site.location.stateOrProvince.map((province) => (\n            <Entity key={province} uri={province} store=\"stateOrProvinceStore\" />\n          ))}\n        </Space>\n      );\n    },\n  },\n  {\n    title: \"Deposit Type\",\n    key: \"depositType\",\n    render: (_: any, site: DedupMineralSite) => {\n      const dt = site.getTop1DepositType();\n      if (dt === undefined) {\n        return \"-\";\n      }\n      return <Entity uri={dt.uri} store=\"depositTypeStore\" />;\n    },\n    // sorter: (a: DedupMineralSite, b: DedupMineralSite) => (a.getTop1DepositType()?.name || \"\").localeCompare(b.getTop1DepositType()?.name || \"\"),\n  },\n  {\n    title: \"Dep. Score\",\n    key: \"depositConfidence\",\n    render: (_: any, site: DedupMineralSite) => {\n      const dt = site.getTop1DepositType();\n      if (dt === undefined) {\n        return \"-\";\n      }\n      return dt.confidence.toFixed(4);\n    },\n  },\n  {\n    title: \"Tonnage (Mt)\",\n    dataIndex: \"totalTonnage\",\n    render: (_: any, site: DedupMineralSite) => {\n      if (site.gradeTonnage !== undefined && site.gradeTonnage.totalTonnage !== undefined) {\n        return site.gradeTonnage.totalTonnage.toFixed(4);\n      }\n      return \"-\";\n    },\n  },\n  {\n    title: \"Grade (%)\",\n    dataIndex: \"totalGrade\",\n    render: (_: any, site: DedupMineralSite) => {\n      if (site.gradeTonnage !== undefined && site.gradeTonnage.totalGrade !== undefined) {\n        return site.gradeTonnage.totalGrade.toFixed(2);\n      }\n      return \"-\";\n    },\n  },\n  {\n    title: \"Action\",\n    key: \"action\",\n  },\n];\n\nexport const DedupMineralSiteTable: React.FC<DedupMineralSiteTableProps> = observer(({ commodity }) => {\n  const { dedupMineralSiteStore, commodityStore } = useStores();\n  const [editingDedupSite, setEditingDedupSite] = useState<string | undefined>(undefined);\n\n  useEffect(() => {\n    if (commodity !== undefined) {\n      dedupMineralSiteStore.fetchByCommodity(commodity);\n    }\n  }, [commodity]);\n\n  if (dedupMineralSiteStore.state.value === \"error\") {\n    return <Alert message=\"Error\" description=\"An error occurred while querying dedup mineral sites. Please try again later.\" type=\"error\" showIcon />;\n  }\n\n  const isLoading = dedupMineralSiteStore.state.value === \"updating\";\n  const dedupMineralSites = commodity === undefined || isLoading ? emptyFetchResult : dedupMineralSiteStore.getByCommodity(commodity);\n  columns[columns.length - 1].render = (_: any, site: DedupMineralSite) => {\n    return (\n      <Space>\n        <Button\n          color=\"primary\"\n          size=\"middle\"\n          icon={<EditOutlined />}\n          variant=\"filled\"\n          onClick={() => {\n            if (site.id === editingDedupSite) {\n              setEditingDedupSite(undefined);\n            } else {\n              setEditingDedupSite(site.id);\n            }\n          }}\n        >\n          Edit\n        </Button>\n        <Button color=\"default\" size=\"middle\" icon={<UngroupOutlined />} variant=\"filled\">\n          Ungroup\n        </Button>\n      </Space>\n    );\n  };\n\n  return (\n    <Table<DedupMineralSite>\n      bordered={true}\n      size=\"small\"\n      rowKey=\"id\"\n      columns={columns}\n      dataSource={dedupMineralSites.records}\n      loading={isLoading ? { size: \"large\" } : false}\n      expandable={{\n        expandedRowRender: (site) => <EditDedupMineralSite commodity={commodity!} dedupSite={site} />,\n        showExpandColumn: false,\n        expandedRowKeys: editingDedupSite === undefined ? [] : [editingDedupSite],\n      }}\n    />\n  );\n});\n","import { Flex } from \"antd\";\nimport { observer } from \"mobx-react\";\nimport { SearchBar, useSearchArgs } from \"./SearchBar\";\nimport { DedupMineralSiteTable } from \"./DedupMineralSiteTable\";\n\nexport const HomePage = observer(() => {\n  const [searchArgs, normSearchArgs, setSearchArgs] = useSearchArgs();\n\n  return (\n    <Flex vertical={true} gap=\"small\">\n      <SearchBar searchArgs={searchArgs} setSearchArgs={setSearchArgs} />\n\n      <DedupMineralSiteTable commodity={normSearchArgs.commodity} />\n    </Flex>\n  );\n});\n","import { Menu } from \"antd\";\nimport { WithStyles, withStyles } from \"@material-ui/styles\";\nimport { useLocation } from \"react-router-dom\";\nimport { getActiveRouteName, PathDef } from \"gena-app\";\nimport React from \"react\";\n\nconst css = {\n  centerNavBar: {\n    justifyContent: \"center\",\n    boxShadow: \"0 2px 8px #f0f1f2\",\n  },\n  leftNavBar: {\n    \"& .logo::after\": {\n      borderBottom: \"none !important\",\n      transition: \"none !important\",\n    },\n    \"& .logo:hover::after\": {\n      borderBottom: \"none !important\",\n      transition: \"none !important\",\n    },\n    \"& .logo img\": {\n      height: 24,\n      borderRadius: 4,\n      marginTop: -2,\n    },\n    paddingLeft: 24,\n    paddingRight: 24,\n    boxShadow: \"0 2px 8px #f0f1f2\",\n  },\n};\n\ntype MenuItemProps = {\n  children: string | JSX.Element;\n  icon?: JSX.Element;\n  danger?: boolean;\n  disabled?: boolean;\n};\n\ninterface Props<R> {\n  menus: Partial<Record<keyof R, string | JSX.Element | MenuItemProps>>;\n  routes: R;\n  className?: string;\n  style?: React.CSSProperties;\n  isFirstItemLogo?: boolean;\n}\ntype Component = <R extends Record<any, PathDef<any, any>>>(_p: Props<R>) => JSX.Element;\n\nexport const CenterNavBar = withStyles(css)(<R extends Record<any, PathDef<any, any>>>({ classes, menus, routes, className, style, isFirstItemLogo }: Props<R> & WithStyles<typeof css>) => {\n  const location = useLocation();\n  const openMenu = (e: { key: keyof R }) => {\n    routes[e.key].path({}, {}).open();\n  };\n\n  const items = Object.keys(menus).map((routeName, index) => {\n    const className = isFirstItemLogo === true && index === 0 ? \"logo\" : \"\";\n    return getMenuItem(routeName, className, menus[routeName]!);\n  });\n  const activeRouteName = getActiveRouteName(location, routes);\n\n  return (\n    <Menu\n      mode=\"horizontal\"\n      className={classes.centerNavBar + (className !== undefined ? \" \" + className : \"\")}\n      style={style}\n      onClick={openMenu}\n      selectedKeys={activeRouteName !== undefined ? [activeRouteName] : undefined}\n    >\n      {items}\n    </Menu>\n  );\n}) as Component;\n\nexport const LeftNavBar = withStyles(css)(<R extends Record<any, PathDef<any, any>>>({ classes, menus, routes, className, style, isFirstItemLogo }: Props<R> & WithStyles<typeof css>) => {\n  const location = useLocation();\n  const openMenu = (e: { key: keyof R }) => {\n    routes[e.key].path({}, {}).open();\n  };\n\n  const items = Object.keys(menus).map((routeName, index) => {\n    const className = isFirstItemLogo === true && index === 0 ? \"logo\" : \"\";\n    return getMenuItem(routeName, className, menus[routeName]!);\n  });\n  const activeRouteName = getActiveRouteName(location, routes);\n\n  return (\n    <Menu\n      mode=\"horizontal\"\n      className={classes.leftNavBar + (className !== undefined ? \" \" + className : \"\")}\n      style={style}\n      onClick={openMenu}\n      selectedKeys={activeRouteName !== undefined ? [activeRouteName] : undefined}\n    >\n      {items}\n    </Menu>\n  );\n}) as Component;\n\nfunction getMenuItem(key: string, className: string, props: string | JSX.Element | MenuItemProps) {\n  let children, realprops;\n\n  if (typeof props === \"string\") {\n    children = props;\n  } else if (React.isValidElement(props)) {\n    children = props;\n  } else {\n    const { children: children2, ...realprops2 } = props as MenuItemProps;\n    children = children2;\n    realprops = realprops2;\n  }\n\n  return (\n    <Menu.Item className={className} key={key} {...realprops}>\n      {children}\n    </Menu.Item>\n  );\n}\n","import { Avatar, Button, Col, List, Row, Typography } from \"antd\";\nimport { observer } from \"mobx-react\";\nimport React, { ReactElement, useEffect } from \"react\";\nimport { InternalLink } from \"gena-app\";\nimport { useStores } from \"../models\";\nimport { routes } from \"../routes\";\n\nexport const RequiredAuthentication = observer(({ children }: { children: ReactElement }) => {\n  const { userStore } = useStores();\n\n  // check & login if not logged in\n  useEffect(() => {\n    userStore.isLoggedIn().then((isLoggedIn) => {\n      if (!isLoggedIn) {\n        routes.login.path().open();\n      }\n    });\n  }, [userStore]);\n\n  return children;\n});\n","import { PathDef, NoArgsPathDef, NoURLArgsPathDef, applyLayout } from \"gena-app\";\nimport { HomePage, LoginPage } from \"./pages\";\n\nimport React, { useEffect } from \"react\";\nimport { LeftNavBar } from \"./components/Navbar\";\nimport { Space } from \"antd\";\n\nimport { RequiredAuthentication } from \"components/RequiredAuthentication\";\n\n/*************************************************************************************\n * Layouts of the application\n */\nexport const Layout = (component: React.FunctionComponent<any> | React.ComponentClass<any, any>) => {\n  return (props: any) => {\n    const element = React.createElement(component, props);\n\n    return (\n      <Space direction=\"vertical\" style={{ width: \"100%\" }}>\n        <LeftNavBar\n          menus={{\n            home: <span>MinMod Editor</span>,\n          }}\n          routes={routes}\n          isFirstItemLogo={true}\n        />\n        <RequiredAuthentication>\n          <div className=\"wide-container\">{element}</div>\n        </RequiredAuthentication>\n      </Space>\n    );\n  };\n};\n\nconst None = () => <h1>Not supposed to see this page</h1>;\n\n/*************************************************************************************\n * Definitions for routes in this application\n */\nexport const routes = {\n  login: new NoArgsPathDef({\n    component: LoginPage,\n    pathDef: \"/login\",\n    exact: true,\n  }),\n  home: new NoURLArgsPathDef({\n    component: HomePage,\n    pathDef: \"/\",\n    exact: true,\n    querySchema: {\n      commodity: \"optionalstring\",\n    },\n  }),\n};\n(window as any)._routes = routes;\n\n// apply this layout to all routes except login\napplyLayout(routes, Layout, [\"login\"]);\n","import React, { useEffect, useState } from \"react\";\nimport \"./login.css\";\nimport { routes } from \"routes\";\nimport { useStores } from \"../../models\";\n\nexport const LoginPage = () => {\n  const { userStore } = useStores();\n\n  const [username, setUsername] = useState<string>(\"\");\n  const [password, setPassword] = useState<string>(\"\");\n  const [error, setError] = useState<string>(\"\");\n\n  useEffect(() => {\n    userStore.isLoggedIn().then((isLoggedIn) => {\n      if (isLoggedIn) routes.home.path({ commodity: undefined }).open();\n    });\n  }, [userStore]);\n\n  const handleLogin = async (event: React.FormEvent) => {\n    event.preventDefault();\n    try {\n      await userStore.login(username, password);\n      routes.home.path({ commodity: undefined }).open();\n    } catch (err) {\n      setError(\"An error occurred. Please try again later.\");\n    }\n  };\n\n  return (\n    <div className=\"login-container\">\n      <h2>Login</h2>\n      <form onSubmit={handleLogin} className=\"login-form\">\n        <div className=\"form-group\">\n          <label htmlFor=\"username\">Username:</label>\n          <input type=\"text\" id=\"username\" value={username} onChange={(e) => setUsername(e.target.value)} required />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"password\">Password:</label>\n          <input type=\"password\" id=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} required />\n        </div>\n        {error && <p className=\"error-message\">{error}</p>}\n        <button type=\"submit\" className=\"login-button\">\n          Login\n        </button>\n      </form>\n    </div>\n  );\n};\n","import { ReactElement, useEffect } from \"react\";\nimport { initNonCriticalStores } from \"models\";\n\nexport const InitNonCriticalStores = ({ children }: { children: ReactElement }) => {\n  useEffect(() => {\n    initNonCriticalStores();\n  }, []);\n\n  return children;\n};\n","import ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport { App } from \"gena-app\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { stores, initStores, StoreContext } from \"./models\";\nimport { routes } from \"./routes\";\nimport enUSIntl from \"antd/lib/locale/en_US\";\nimport { ConfigProvider } from \"antd\";\nimport { InitNonCriticalStores } from \"components/StoreInit\";\n\ninitStores().then(() => {\n  ReactDOM.render(\n    <StoreContext.Provider value={stores}>\n      <ConfigProvider locale={enUSIntl}>\n        <InitNonCriticalStores>\n          <App enUSLocale={true} routes={routes} />\n        </InitNonCriticalStores>\n      </ConfigProvider>\n    </StoreContext.Provider>,\n    document.getElementById(\"root\")\n  );\n});\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}